/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
 Utils, Database, Migrator
 */
"use strict";

function makeLocalDBMS(fullVersion){
//    if(!fullVersion){
//        function LocalDBMS(){
//        };
//        return LocalDBMS;
//    }
    
    var opts = {
        Migrator     : Migrator    ,
        CommonUtils  : CommonUtils ,
        EventEmitter : EventEmitter,
        R            : R           ,
        Ajv          : Ajv         ,
        Schema       : Schema      ,
        Errors       : Errors      ,
        listeners    : {}          ,
        Constants    : Constants   ,
        dbmsUtils    : {}          ,
        dateFormat   : dateFormat  ,
    };
    
    function LocalDBMS(){
        this._init(opts.listeners);
    };
    
    LocalDBMS.prototype.getSettings = function(){
        "use strict";
        return this.database.Settings;
    };
    
    var func = (name) => window[name](LocalDBMS, opts);
    
    ["baseAPI"               ,
    "consistencyCheckAPI"   ,
    "entityAPI"             ,
    "logAPI"                ,
    "shopAPI"               ,
    "assetsAPI"               ,
    "externalAPI"               ,
//    "statisticsAPI"         ,
//    "profilesAPI"           ,
//    "profileBindingAPI"     ,
//
//    "profileViewAPI"        ,
//    
//    "groupsAPI"             ,
//    "groupSchemaAPI"        ,
//    "investigationBoardAPI" ,
//    "relationsAPI"          ,
//    "briefingExportAPI"     ,
//    
//    "profileConfigurerAPI"  ,
//    "storyBaseAPI"          ,
//    "storyEventsAPI"        ,
//    "storyCharactersAPI"    ,
//    
//    "storyViewAPI"          ,
//    "storyAdaptationsAPI"   ,
//    "accessManagerAPI"      ,
//    "textSearchAPI"         ,
    ].map(func);
    
    Logger.attachLogCalls(LocalDBMS, R, false);
    return LocalDBMS;
};



/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
 Utils, Database
 */
"use strict";

var showNotification = true;
function makeRemoteDBMS(LocalDBMS){
    
//    var url = "/";

    var url = window.location.href.substring(0, window.location.href.lastIndexOf('/')+1);
//    var url = window.location.pathname;
    
    function RemoteDBMS(){
        this.clearSettings();
    };
    
    RemoteDBMS._simpleGet = function(name, params, callback){
        "use strict";
        var paramStr = "";
        if(params){
            paramStr = "?params=" + encodeURIComponent(JSON.stringify(params)); ; 
        }
        
        var request = $.ajax({
            url : url + name + paramStr,
            dataType : "text",
            method : "GET",
            contentType : "application/json;charset=utf-8",
            cache: false,
            timeout: Constants.httpTimeout,
        });
        
        request.done(function(data) {
            callback(null, JSON.parse(data));
        });
        
        request.fail(function(errorInfo, textStatus, errorThrown) {
            try {
                callback(JSON.parse(errorInfo.responseText));
            } catch(err){
                callback(errorInfo.responseText || textStatus || 'error');
            }
        });
    };
    
    RemoteDBMS._simplePut = function(name, data, callback){
        "use strict";
        var request = $.ajax({
            url : url + name,
            dataType : "text",
            method : "PUT",
            contentType : "application/json;charset=utf-8",
            data: JSON.stringify(data),
            timeout: Constants.httpTimeout
        });
        
        if(showNotification){
            var notificationBox = clearEl(getEl('debugNotification'));
            removeClass(notificationBox, 'hidden');
            removeClass(notificationBox, 'operationOK');
            removeClass(notificationBox, 'operationFail');
//            addEl(notificationBox, makeText(name + ' ' + JSON.stringify(data)));
            addEl(notificationBox, makeText(name));
        }
        
        request.done(function(data) {
            if(showNotification){
                addClass(notificationBox, 'operationOK');
                setTimeout(function(){
                    addClass(notificationBox, 'hidden');
                }, 2000);
            }
            if(callback) callback();
        });
        
        request.fail(function(errorInfo, textStatus, errorThrown) {
            if(showNotification){
                addClass(notificationBox, 'operationFail');
                setTimeout(function(){
                    addClass(notificationBox, 'hidden');
                }, 2000);
            }
            try {
                callback(JSON.parse(errorInfo.responseText));
            } catch(err){
                callback(errorInfo.responseText || textStatus || 'error');
            }
        });
    };
    
    
    Object.keys(LocalDBMS.prototype).forEach(function(name){
        RemoteDBMS.prototype[name] = function(){
            var arr = [];
            for (var i = 0; i < arguments.length-1; i++) {
                arr.push(arguments[i]);
            }
//            if(CommonUtils.startsWith(name, "_")){
//                // do nothing for inner functions
//            } else 
            if(CommonUtils.startsWith(name, "get") || CommonUtils.startsWith(name, "is")){
                RemoteDBMS._simpleGet(name, arr, arguments[arguments.length-1]);
            } else {
                RemoteDBMS._simplePut(name, arr, arguments[arguments.length-1]);
            }
        }
    });
    
    
    RemoteDBMS.prototype.clearSettings = function() {
        "use strict";
        this.Settings = {
                "BriefingPreview" : {},
                "Stories" : {},
                "ProfileEditor" : {}
        };
    };
    
    RemoteDBMS.prototype.getSettings = function(){
        "use strict";
        return this.Settings;
    };
    return RemoteDBMS;
};



/*Copyright 2015-2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
 Utils, saveAs, FileReader, Blob
 */

"use strict";

var FileUtils = {};

FileUtils.init = function (callback) {
    "use strict";
    FileUtils.callback = callback;
};

FileUtils.makeNewBase = function () {
    "use strict";
    Utils.confirm(getL10n("utils-new-base-warning"), () => {
        DBMS.setDatabase(CommonUtils.clone(EmptyBase.data), FileUtils.callback);
    });
};

FileUtils.openHelp = function () {
    "use strict";
    window.open("extras/doc/nims.html");
};

FileUtils.readSingleFile = function (evt) {
    "use strict";
    // Retrieve the first (and only!) File from the FileList object
    var f = evt.target.files[0];

    if (f) {
        var r = new FileReader();
        r.onload = function (e) {
            var contents = e.target.result;
            var database = JSON.parse(contents);
            DBMS.setDatabase(database, FileUtils.callback);
        };
        r.readAsText(f);
    } else {
        Utils.alert(getL10n("utils-base-file-loading-error"));
    }
};

FileUtils.saveFile = function () {
    "use strict";
    DBMS.getDatabase(function(err, database){
        if(err) {Utils.handleError(err); return;}
        FileUtils.json2File(database, "nims-base.json");
    });
};

FileUtils.json2File = function (str, fileName) {
    "use strict";
    FileUtils.str2File(JSON.stringify(str, null, '  '), fileName);
};

FileUtils.str2File = function (str, fileName) {
    "use strict";
    var blob = new Blob([ str ], {
        type : "text/plain;charset=utf-8"
    });
    saveAs(blob, fileName);
};


/*Copyright 2015-2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
 */

"use strict";

(function(exports, Dictionaries){

    var state = {};
    
    state.initialized = false;
    state.l10nDelegates = [];
    state.dictionaries = {};
    state.lang = defaultLang;
    
    var init = function(){
        if(state.initialized){
            return;
        }
//        console.log(navigator.language);
        
        for(var name in Dictionaries){
            state.dictionaries[name] = processDictionary(Dictionaries[name]);
        }
        
    //    var lang = (navigator.languages ? navigator.languages[0] : navigator.browserLanguage).split('-')[0];
    //    var lang = 'ru';
//        var lang = defaultLang;
//        console.log(lang);
        
        if(state.dictionaries[defaultLang]){
            state.dict = state.dictionaries[defaultLang];
        } else {
            state.dict = state.dictionaries['en'];
        }
        setHtmlLang(defaultLang);
        exports.onL10nChange(exports.localizeStatic);
        state.initialized = true;
    };
    
    var processDictionary = function(dictionary){
        var processedDictionary = {};
        for(var sectionName in dictionary){
            for(var name in dictionary[sectionName]){
                processedDictionary[sectionName+"-"+name] = dictionary[sectionName][name];
            }
        } 
        return processedDictionary;
    };
    
    var setHtmlLang = (lang) => setAttr(document.getElementsByTagName("html")[0],'lang', lang);
    
    exports.toggleL10n = function(){
        if(state.lang === "ru"){
            state.dict = state.dictionaries['en'];
            state.lang = "en";
        } else {
            state.dict = state.dictionaries['ru'];
            state.lang = "ru";
        }
        setHtmlLang(state.lang);
        state.l10nDelegates.forEach(function(delegate){
            delegate();
        });
    };
    
    exports.getLang = () => state.lang.toLowerCase();
    
    exports.format = R.curry(function(namespace, name, args){
        return strFormat(exports.get(namespace, name), args);
    });

    exports.get = R.curry(function(namespace, name){
        return L10n.getValue(namespace + '-' + name);
    });
    
    exports.getValue = function(name){
        var value = state.dict[name];
        if(value === undefined) console.log("Value is not found: " + name);
        return value ? value : name + ":RA RA-AH-AH-AH ROMA ROMA-MA GAGA OH LA-LA";
    };
    
    exports.onL10nChange = function(delegate){
        state.l10nDelegates.push(delegate);
    };
    
    exports.localizeStatic = function(){
        init();
        nl2array(document.querySelectorAll("[l10n-id]")).map(el => addEl(clearEl(el), makeText(exports.getValue(getAttr(el,"l10n-id")))));
        nl2array(document.querySelectorAll("[l10n-placeholder-id]")).map(el => setAttr(el,"placeholder", exports.getValue(getAttr(el,"l10n-placeholder-id"))));
    };

})(this['L10n']={}, Dictionaries);
/*Copyright 2015-2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

"use strict";

(function(exports){

    exports.initTabPanel = function(tabClazz, containerClazz) {
        var containers = getEls(containerClazz);
    
        var i;
        for (i = 1; i < containers.length; i++) { // don't hide 1st element
            addClass(containers[i], "hidden");
        }
    
        var tabButtons = getEls(tabClazz);
    
        addClass(tabButtons[0], "active");
    
        for (i = 0; i < tabButtons.length; i++) {
            listen(tabButtons[i], "click", tabButtonClick(tabButtons, containers));
        }
    };
    
    var tabButtonClick = function(buttons, containers) {
        return function(event) {
            for (var i = 0; i < buttons.length; i++) {
                setClassByCondition(buttons[i], "active", event.target.id === buttons[i].id);
            }
            for (var i = 0; i < containers.length; i++) {
                setClassByCondition(containers[i], "hidden", event.target.id + "Container" !== containers[i].id);
            }
        };
    };
    
    exports.fillShowItemSelector = function (selector, displayArray) {
        var el;
        setAttr(selector, "size", displayArray.length);
        displayArray.forEach(function(value) {
            el = setProps(makeEl("option"), {
                "selected" : true,
            });
            setClassByCondition(el, 'hidden', value.hidden);
            addEl(selector, addEl(el, makeText(value.name)));
        });
    };
    
    exports.fillShowItemSelector2 = function (selector, optionGroups) {
        var el, groupEl, counter = 0;
        addEls(selector, optionGroups.map(function(group) {
            counter++;
            groupEl = setAttr(makeEl("optgroup"), 'label', group.name);
            addEls(groupEl, group.array.map((value) => {
                el = setProps(makeEl("option"), {
                    "selected" : true,
                });
                setClassByCondition(el, 'hidden', value.hidden);
                counter += (value.hidden ? 0 : 1);
                return addEl(el, makeText(value.name));
            }));
            return groupEl;
        }));
        setAttr(selector, "size", counter);
    };
    
    exports.showSelectedEls = function(classKey){
        return function(event){
            var el = event.target;
            var els, i, j;
            for (i = 0; i < el.options.length; i += 1) {
                els = getEls(i + classKey);
                for (j = 0; j < els.length; j++) {
                    setClassByCondition(els[j], "hidden", !el.options[i].selected);
                }
            }
        }
    };
    
    exports.initSelectorFilters = function(){
        var elems = document.querySelectorAll("[selector-filter]");
        var el, sel;
        for (var i = 0; i < elems.length; i++) {
            el = elems[i];
            sel = queryEl(getAttr(el,"selector-filter"));
            el.value = '';
            listen(el, "input", filterOptions(sel))
        }
    };
    
    var filterOptions = function(sel){
        return function(event){
            var val = event.target.value;
            var i, opt;
            val = CommonUtils.globStringToRegex(val.trim().toLowerCase());
            for (i = 0; i < sel.options.length; i += 1) {
                opt = sel.options[i];
                var isVisible = opt.innerHTML.toLowerCase().search(val) !== -1;
                if(!isVisible){
                    opt.selected = false;
                }
                setClassByCondition(opt, "hidden", !isVisible);
//                setClassByCondition(opt, "hidden", opt.innerHTML.toLowerCase().search(val) === -1);
            }
            sel.dispatchEvent(new Event('change'));
        }
    };
    
    exports.initPanelTogglers = function(){
        var elems = document.querySelectorAll("[panel-toggler]");
        var el, sel, attr;
        for (var i = 0; i < elems.length; i++) {
            el = elems[i];
            attr = getAttr(el,"panel-toggler");
            sel = document.querySelector(attr);
            if(sel == null){
                Utils.alert("Panel toggler is broken: " + attr);
            }
            listen(el, "click", exports.togglePanel(sel))
        }
    };
    
    exports.togglePanel = function(sel){
        return function(event){
            toggleClass(sel, "hidden");
        }
    };
    
    exports.makeEventTimePicker = function (opts) {
        var input = makeEl("input");
        R.ap([addClass(input)], opts.extraClasses);
        addClass(input, "eventTime");
        input.value = opts.eventTime;
        
        input.eventIndex = opts.index;
        
        var pickerOpts = {
            lang : L10n.getLang(),
            mask : true,
            startDate : new Date(opts.preGameDate),
            endDate : new Date(opts.date),
            onChangeDateTime : opts.onChangeDateTimeCreator(input),
        };
        
        if (opts.eventTime !== "") {
            pickerOpts.value = opts.eventTime;
        } else {
            pickerOpts.value = opts.date;
            addClass(input, "defaultDate");
        }
        
        jQuery(input).datetimepicker(pickerOpts);
        return input;
    };
    
    // bug about setting 0900 years in Braavos game is event date. Fixed in production.
//  exports.makeEventTimePicker = function (opts) {
//      var input = makeEl("input");
//      R.ap([addClass(input)], opts.extraClasses);
//      addClass(input, "eventTime");
//      input.value = opts.eventTime;
//      
//      input.eventIndex = opts.index;
//      
//      var pickerOpts = {
//          lang : L10n.getLang(),
//          mask : true,
//          startDate : new Date(opts.preGameDate),
//          endDate : new Date(opts.date),
//          onChangeDateTime : opts.onChangeDateTimeCreator(input),
//      };
//      
//      var picker = jQuery(input).datetimepicker(pickerOpts);
//      
//      var value;
//      if (opts.eventTime !== "") {
//          value = new Date(opts.eventTime);
//      } else {
//          value = opts.date;
//          addClass(input, "defaultDate");
//      }
//      
//      picker.value = value;
//      
//      
//      return input;
//  };
    
    exports.resizeTextarea = function (ev) {
        var that = ev.target;
        that.style.height = '24px';
        that.style.height = that.scrollHeight + 12 + 'px';
    };
    
    exports.resizeTextarea2 = function (that) {
        that.style.height = '24px';
        that.style.height = that.scrollHeight + 12 + 'px';
    };
    
    exports.makeAdaptationTimeInput = function(storyName, event, characterName, isEditable){
        var input = makeEl("input");
        setClassByCondition(input, "notEditable", !isEditable);
        addClass(input,"adaptationTimeInput");
        input.value = event.characters[characterName].time;
        input.dataKey = JSON.stringify([storyName, event.index, characterName]);
        listen(input, "change", onChangePersonalTimeDelegate);
        return input;
    };
    
    var onChangePersonalTimeDelegate = function (event) {
        var dataKey = JSON.parse(event.target.dataKey);
        var time = event.target.value;
        DBMS.setEventAdaptationProperty(dataKey[0], dataKey[1], dataKey[2], 'time', time, Utils.processError());
    };
    
    exports.makeAdaptationReadyInput = function(storyName, event, characterName, isEditable){
        var div = makeEl("div");
        var input = makeEl("input");
        setClassByCondition(input, "notEditable", !isEditable);
        input.type = "checkbox";
        input.checked = event.characters[characterName].ready;
        input.dataKey = JSON.stringify([storyName, event.index, characterName]);
        input.id = event.index + "-" + storyName + "-" + characterName;
        listen(input, "change", onChangeReadyStatus);
        addEl(div, input);
        
        addEl(div, setAttr(addEl(makeEl("label"), makeText(constL10n(Constants.finishedText))), "for", input.id));
        return div;
    };
    
    var onChangeReadyStatus = function (event) {
        var dataKey = JSON.parse(event.target.dataKey);
        var value = event.target.checked;
        DBMS.setEventAdaptationProperty(dataKey[0], dataKey[1], dataKey[2], 'ready', value, Utils.processError());
    };
    
    exports.makePanelCore = function(title, content){
        var panel = addClasses(makeEl('div'), ["panel", "panel-default"]);
        var h3 = addClass(addEl(makeEl('h3'), title), "panel-title");
        var a = setAttr(makeEl('a'),'href','#/');
        var headDiv = addClass(makeEl('div'), "panel-heading");
        addEl(panel, addEl(headDiv, addEl(a, h3)));
        var contentDiv = addClass(makeEl('div'), "panel-body");
        addEl(panel, addEl(contentDiv, content));
        return {
            panel: panel,
            contentDiv: contentDiv,
            a: a
        };
    };
    
    exports.makeProfileTable = function(profileStructure, profile){
        var value;
        var profileDiv = addEls(makeEl('tbody'), profileStructure.filter(element => element.doExport).map(function (element) {
            switch (element.type) {
            case "text":
                value = addClass(makeEl("span"), "briefingTextSpan");
                addEl(value, makeText(profile[element.name]));
                break;
            case "enum":
            case "multiEnum":
            case "number":
            case "string":
                value = makeText(profile[element.name]);
                break;
            case "checkbox":
                value = makeText(constL10n(Constants[profile[element.name]]));
                break;
            default:
                throw new Error('Unexpected type ' + element.type);
            }
            return exports.makeTableRow(makeText(element.name), value);
        }));
        return addEl(addClasses(makeEl('table'), ['table','table-striped']), profileDiv);
    };
    
    exports.makeTableRow = function(col1, col2){
        return addEls(makeEl('tr'), [addEl(makeEl('td'), col1), addEl(makeEl('td'),col2)]);
    };

})(this['UI']={});
/*Copyright 2015-2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

"use strict";

var Utils = {};

/** opts
 *      tooltip - add tooltip to button, used for iconic buttons
 *      id - set button id
 *      mainPage - enable view as first page
 *      toggle - toggle content, associated with button
 */
Utils.addView = function (containers, name, view, opts) {
    "use strict";
    var opts = opts || {};
    view.init();
    var buttonClass = "navigation-button";
    containers.root.views[name] = view;
    var button = makeEl("button");
    if(opts.tooltip){
        var delegate = function(){
            $(button).attr('data-original-title', L10n.getValue("header-" + name));
        };
        L10n.onL10nChange(delegate);
        $(button).tooltip({
            title : L10n.getValue("header-" + name),
            placement : "bottom"
        });
    } else {
        addEl(button, makeText(L10n.getValue("header-" + name)));
        setAttr(button, "l10n-id", "header-" + name);
    }
    addClass(button, buttonClass);
    addClass(button, "-test-" + name);
    addClass(button, "-toggle-class-" + name);
    if(opts.clazz){
        addClass(button, opts.clazz);
    }
    containers.navigation.appendChild(button);
    

    var elems, i;
    var onClickDelegate = function (view) {
        return function (evt) {
            //Tests.run();
            elems = containers.navigation.getElementsByClassName(buttonClass);
            if(opts.toggle){
                var els = getEls("-toggle-class-" + name);
                for (var i = 0; i < els.length; i++) {
                    if(evt.target.isEqualNode(els[i])){
                        continue;
                    }
                    if(hasClass(els[i], "active")){
                        els[i].click();
                    }
                }
            }
            
            var isActive = hasClass(evt.target, "active");
            for (i = 0; i < elems.length; i++) {
                removeClass(elems[i], "active");
            }
            if(!opts.toggle || (opts.toggle && !isActive)){
                addClass(evt.target, "active");
                
                passEls(containers.content, getEl('warehouse'));
                containers.content.appendChild(view.content);
                removeClass(containers.content, "hidden");
                containers.root.currentView = view;
                view.refresh();
            } else {
                removeClass(evt.target, "active");
                passEls(containers.content, getEl('warehouse'));
                containers.root.currentView = null;
                addClass(containers.content, "hidden");
            }
        };
    };

    button.addEventListener("click", onClickDelegate(view));
    if (opts.mainPage) {
        addClass(button, "active");
        containers.content.appendChild(view.content);
        containers.root.currentView = view;
    }
};

Utils.alert = function (message) {
    vex.dialog.alert(message);
};

Utils.confirm = function (message, onOk, onCancel) {
    vex.dialog.confirm({
        message: message,
        callback: (val) => {
            if(val){
                if(onOk) onOk();
            } else {
                if(onCancel) onCancel();
            }
        }
    });
};

Utils.removeChildren = function (myNode) {
    "use strict";
    if (!myNode) {
        return;
    }
    while (myNode.firstChild) {
        myNode.removeChild(myNode.firstChild);
    }
};

Utils.processError = function(callback){
    return function(err){
        if(err) {
            Utils.handleError(err);
            return;
        }
        
        if(callback){
            var arr = [];
            for (var i = 1; i < arguments.length; i++) {
                arr.push(arguments[i]);
            }
            callback.apply(null, arr);
        }
    }
};

Utils.handleErrorMsg = function(err){
    var checkErrorType = R.curry(function(err, name){
        return err instanceof Errors[name] || (err.name && err.name === name)
    });
    if (R.keys(Errors).some(checkErrorType(err))) {
        return strFormat(getL10n(err.messageId), err.parameters);
    } else if( typeof err === 'object'){
        return err.message;
    } else {
        return err;
    }
};

Utils.handleError = (err) => Utils.alert(Utils.handleErrorMsg(err));

Utils.enableEl = R.curry(function(el, condition){
    var key = el.tagName.toLowerCase() === "textarea" ? "readonly" : "disabled";
    if(condition){
        el.removeAttribute(key);
    } else {
        el.setAttribute(key,key);
    }
});

Utils.enable = function(root, className, condition){
    nl2array(root.getElementsByClassName(className)).map(Utils.enableEl(R.__, condition));
};

Utils.charOrdAObject = CommonUtils.charOrdAFactory(function(a){
    return a.displayName.toLowerCase();
});

Utils.rebuildSelector = function(selector, names){
    "use strict";
    clearEl(selector);
    names.forEach(function (nameInfo) {
        var option = makeEl("option");
        option.appendChild(makeText(nameInfo.displayName));
        option.value = nameInfo.value;
        selector.appendChild(option);
    });
};

Utils.rebuildSelectorArr = function(selector, names){
    "use strict";
    clearEl(selector);
    names.forEach(function (name) {
        var option = makeEl("option");
        option.appendChild(makeText(name));
        selector.appendChild(option);
    });
};

String.prototype.endsWith = function (suffix) {
    "use strict";
    return this.indexOf(suffix, this.length - suffix.length) !== -1;
};

var strFormat = R.curry(CommonUtils.strFormat);

function getL10n(key){
    return L10n.getValue(key);
};

function constL10n(key){
    return L10n.getValue('constant-' + key);
}

function isEmpty (obj) {
    "use strict";
    return (Object.getOwnPropertyNames(obj).length === 0);
};

var addClass = R.curry(function(o, c){
    var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g")
    if (re.test(o.className)) return;
    o.className = (o.className + " " + c).replace(/\s+/g, " ").replace(/(^ | $)/g, "");
    return o;
});

var addClasses = R.curry(function(o, c){
    R.ap([addClass(o)], c);
    return o;
});

var rAddClass = R.curry(function(c, o){
  var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g")
  if (re.test(o.className)) return;
  o.className = (o.className + " " + c).replace(/\s+/g, " ").replace(/(^ | $)/g, "");
  return o;
});

var toggleClass = R.curry(function(o, c){
    if(hasClass(o, c)){
        removeClass(o, c);
    } else {
        addClass(o, c);
    }
});

function hasClass(o, c){
    var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g")
    return (re.test(o.className));
};
 
var removeClass = R.curry(function(o, c){
    var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g")
    o.className = o.className.replace(re, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "")
});

function setClassByCondition(o,c,condition){
    if(condition){
        addClass(o,c);
    } else {
        removeClass(o,c);
    }
    return o;
};

function getEl(id){
  return document.getElementById(id);
};

function queryEl(sel){
    return document.querySelector(sel);
};

function queryEls(sel){
    return nl2array(document.querySelectorAll(sel));
};

function queryElEls(el, sel){
    return nl2array(el.querySelectorAll(sel));
};

function getEls(clazz){
  return document.getElementsByClassName(clazz);
};

function makeEl(elTag){
  return document.createElement(elTag);
};

function makeText(text){
  return document.createTextNode(text);
};

var addEl = R.curry(function(parent, child){
    parent.appendChild(child);
    return parent;
});
var addEls = R.curry(function(parent, children){
    R.ap([addEl(parent)], children);
    return parent;
});

var makeOpt = function(label){
    var option = makeEl("option");
    addEl(option, (makeText(label)));
    return option;
};

var rAddEl = R.curry(function(child, parent){
  parent.appendChild(child);
  return parent;
});

var setAttr = R.curry(function(el, name, value){
  el.setAttribute(name, value);
  return el;
});

var setStyle = R.curry(function(el, name, value){
    el.style[name] = value;
    return el;
});

function delAttr(el, name){
    el.removeAttribute(name);
    return el;
};

function getAttr(el, name){
    return el.getAttribute(name);
};

var setProp = R.curry(function(el, key, value){
  el[key] = value;
  return el;
});

var setProps = R.curry(function(el, map){
  for(var key in map){
    setProp(el, key, map[key]);
  }
  return el;
});

function clearEl(el){
  Utils.removeChildren(el);
  return el;
};

function passEls(src, dst){
    for (var i = 0; i < src.children.length; i++) {
        addEl(dst, src.children[i]);
    }
};

var listen = R.curry(function(el, event, listener){
  el.addEventListener(event, listener);
  return el;
});

var listenOnEnter = R.curry(function(el, callback){
    listen(el, 'keydown', function(e) {
        if (e.keyCode === 13) {
            callback();
        }
    });
});

var fillSelector = R.curry(function(sel, data){
    return addEls(sel, data.map(function (item) {
        var opt = makeEl("option");
        addEl(opt, makeText(item.name));
        if(item.value){opt.value = item.value;}
        if(item.selected){opt.selected = true;}
        if(item.className){addClass(opt, item.className);}
        return opt;
    }));
});

function nl2array(nodeList){
    return Array.prototype.slice.call(nodeList);
};

var remapProps = R.curry(function(outKeys, pickKeys, obj){
    return R.compose(R.zipObj(outKeys), R.values, R.pick(pickKeys))(obj);
});

var remapProps4Select2 = remapProps(['id','text'], ['value', 'displayName']);
var remapProps4Select = remapProps(['value','name'], ['value', 'displayName']);

var getSelect2DataCommon = R.curry(function(preparator, obj){ 
    return R.compose(R.zipObj(['data']), R.append(R.__, []), R.map(preparator))(obj);
});

var getSelect2Data = getSelect2DataCommon(remapProps4Select2);

var makeSelect2Opt = R.compose(R.zipObj(['id', 'text']), R.repeat(R.__, 2));
var arr2Select2 = R.compose(R.assoc('data', R.__, {}), R.map(makeSelect2Opt));
var arr2Select = R.map(R.compose(R.zipObj(['value','name']), R.repeat(R.__, 2)));
var constArr2Select = R.map(R.compose(R.zipObj(['value','name']), (name) => [name, constL10n(name)]));

var getSelectedRadio = function(query){
    var els = document.querySelectorAll(query);
    for (var i = 0; i < els.length; i++) {
        if(els[i].checked === true){
            return els[i];
        }
    }
    return null;
};

var debugInterceptor = function(callback){
    return function(){
        console.log(JSON.stringify(arguments[0]));
        callback.apply(null, arguments);
    }
};

// from date format utils
//For convenience...
Date.prototype.format = function (mask, utc) {
    return dateFormat(this, mask, utc);
};


/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
Utils, Overview, Profiles, Stories, Adaptations, Briefings, Timeline, SocialNetwork, FileUtils
 */

"use strict";

(function(exports){

    var state = {};
    state.views = {};
    
    var btnOpts = {
        tooltip : true,
        className : 'mainNavButton'
    }
    
    var initPage = function(){
        L10n.localizeStatic();
        L10n.onL10nChange(() => state.currentView.refresh());
        UI.initSelectorFilters();
        UI.initPanelTogglers();
        function updateDialogs(){
            vex.dialog.buttons.YES.text = getL10n('common-ok');
            vex.dialog.buttons.NO.text = getL10n('common-cancel');
        }
        updateDialogs();
        L10n.onL10nChange(updateDialogs);
    }
    
    var curTheme = Constants.themeList[1];
    
    var initTheme = function() {
        if(DBMS.setTheme){
            DBMS.getTheme(function(err, theme){
                if(err) {console.log(err);}
                if(theme !== ''){
                    curTheme = theme;
                }
                addClass(queryEl('body'), curTheme);
            });
        } else {
            addClass(queryEl('body'), curTheme);
        }
    };
    
    var nextTheme = function() {
        removeClass(queryEl('body'), curTheme);
        curTheme = Constants.themeList[(R.indexOf(curTheme, Constants.themeList)+1)%Constants.themeList.length];
        addClass(queryEl('body'), curTheme);
        if(DBMS.setTheme){
            DBMS.setTheme(curTheme, function(err){
                if(err) {console.log(err); return;}
            });
        }
    };
    
    var protoExpander = function(arr){
        function protoCarrier(){};
        arr.forEach( name => protoCarrier.prototype[name] = (() => 1));
        return protoCarrier;
    };
    
    var playerArr = [
                    'getShop'        ,
                    "createCategory" ,
                    "renameCategory" ,
                    "removeCategory" ,
                    
                    "getLocalAsset",
                    "createLocalAsset",
                    "renameLocalAsset",
                    "removeLocalAsset",
                    
                    "updateLocalAssetField",
                    "setAssetCost",
                    "addGlobalAssetToCategory",
                    "addLocalAssetToCategory" ,
                    
                    "removeGlobalAssetFromCategory",
                    "removeLocalAssetFromCategory",
                    "getShopName",
                    "getAsset",
                    
                    "getShopIndex",
                    "getGlobalAssetDisplayNames",
                    "buyAsset",
                    "getTheme",
                    "setTheme",
                    ];
    
    exports.onPlayerPageLoad = function () {
        initPage();
        var RemoteDBMS = makeRemoteDBMS(protoExpander(playerArr));
        window.DBMS = new RemoteDBMS();
        initTheme();
        stateInit();
        Utils.addView(state.containers, "shop-management", PlayerShopManagement, {mainPage:true});
        Utils.addView(state.containers, "shop-window", ShopWindow);
        Utils.addView(state.containers, "shop-about", ShopAbout);
        addEl(state.navigation, addClass(makeEl("div"), "nav-separator"));
        addEl(state.navigation, makeL10nButton());
        addEl(state.navigation, makeButton("themeButton", "theme", () => nextTheme(), btnOpts));
        addEl(state.navigation, makeButton("logoutButton", "logout", postLogout, btnOpts));
        addEl(state.navigation, makeButton("refreshButton", "refresh", () => state.currentView.refresh(), btnOpts));
        addEl(state.navigation, makeButton("fullScreenButton", "fullScreen", toggleToolbarButtons, btnOpts));
        state.currentView.refresh();
    };
    
    var toggleToolbarButtons = () => {
        queryEls('#navigation > button').filter( button => !hasClass(button, 'refreshButton') && !hasClass(button, 'fullScreenButton'))
                                        .map(toggleClass(R.__, 'hidden'));
    };
    
    exports.onIndexPageLoad = function () {
        initPage();
        var RemoteDBMS = makeRemoteDBMS(protoExpander(['getPlayersOptions','getRoleGridInfo']));
        window.DBMS = new RemoteDBMS();
        initTheme();
        stateInit();
        addEl(state.navigation, addClass(makeEl("div"), "nav-separator"));
        Utils.addView(state.containers, "enter", Enter, {mainPage:true});
            addEl(state.navigation, makeL10nButton());
        state.currentView.refresh();
    };
    
    exports.onMasterPageLoad = function () {
        initPage();
        var LocalDBMS = makeLocalDBMS(true);
        if(MODE === "Standalone"){
            window.DBMS = new LocalDBMS();
            DBMS.setDatabase(BaseExample.data, function(err){
                if(err) {Utils.handleError(err); return;}
                consistencyCheck(onDatabaseLoad);
            });
        } else if(MODE === "NIMS_Server") {
            var RemoteDBMS = makeRemoteDBMS(LocalDBMS);
            window.DBMS = new RemoteDBMS();
            consistencyCheck(onDatabaseLoad);
        }
    };
    
    var consistencyCheck = function(callback){
        DBMS.getConsistencyCheckResult(function(err, consistencyErrors){
            if(err) {Utils.handleError(err); return;}
            consistencyErrors.forEach(CommonUtils.consoleLog);
            if(consistencyErrors.length > 0){
                Utils.alert(getL10n('overview-consistency-problem-detected'));
            } else {
                console.log('Consistency check didn\'t find errors');
            }
            callback();
        });
    };
    
    var stateInit = function(){
        state.navigation = getEl("navigation");
        state.containers = {
                root: state,
                navigation: state.navigation,
                content: getEl("contentArea")
        };
    };
    
    var onDatabaseLoad = function () {
        initTheme();
        PermissionInformer.refresh(function(err){
            if(err) {Utils.handleError(err); return;}
            
            PermissionInformer.isAdmin(function(err, isAdmin){
                if(err) {Utils.handleError(err); return;}
                
                var button;
                stateInit();

                Utils.addView(state.containers, "shop-management", MasterShopManagement, {mainPage:true});
                Utils.addView(state.containers, "shops2", Shops2);
                Utils.addView(state.containers, "assets", Assets);
                Utils.addView(state.containers, "apiCheck", ApiCheck);
                
                addEl(state.navigation, addClass(makeEl("div"), "nav-separator"));
                
                if(isAdmin){
                    var button = makeButton("dataLoadButton", "open-database", null, btnOpts);
                    button.addEventListener('change', FileUtils.readSingleFile, false);
                    
                    var input = makeEl("input");
                    input.type = "file";
                    addClass(input, 'hidden');
                    setAttr(input, 'tabindex', -1);
                    button.appendChild(input);
                    button.addEventListener('click', function(e){
                        input.click();
    //                    e.preventDefault(); // prevent navigation to "#"
                    });
                    addEl(state.navigation, button);
                }
                
                addEl(state.navigation, makeButton("themeButton", "theme", () => nextTheme(), btnOpts));
                addEl(state.navigation, makeButton("dataSaveButton", "save-database", FileUtils.saveFile, btnOpts));
                if(MODE === "Standalone"){
                    addEl(state.navigation, makeButton("newBaseButton", "create-database", FileUtils.makeNewBase, btnOpts));
                }
//                addEl(state.navigation, makeButton("mainHelpButton", "docs", FileUtils.openHelp, btnOpts));
                
                addEl(state.navigation, makeL10nButton());
                
                Utils.addView(state.containers, "logViewer", LogViewer2, {clazz:"logViewerButton", tooltip:true});
                addEl(state.navigation, makeButton("testButton", "test", runTests, btnOpts));
                if(MODE === "NIMS_Server"){
//                    Utils.addView(state.containers, "admins", AccessManager, {clazz:"accessManagerButton", tooltip:true});
                    addEl(state.navigation, makeButton("logoutButton", "logout", postLogout, btnOpts));
                }
                addEl(state.navigation, makeButton("refreshButton", "refresh", () => state.currentView.refresh(), btnOpts));
                
                FileUtils.init(function(err){
                    if(err) {Utils.handleError(err); return;}
                    consistencyCheck(state.currentView.refresh);
                });
                
                state.currentView.refresh();
                if(MODE === "Standalone") {
                    addBeforeUnloadListener();
                }
            });
        });
        
    };
    
    var makeL10nButton = function(){
        var l10nBtn = makeButton("toggleL10nButton", "l10n", L10n.toggleL10n, btnOpts);
        var setIcon = function(){
            l10nBtn.style.backgroundImage = strFormat('url("./images/{0}.svg")', [getL10n('header-dictionary-icon')]);
        }
        L10n.onL10nChange(setIcon);
        setIcon();
        return l10nBtn;
    };
    
    var runTests = function(){
    //    window.RunTests();
        consistencyCheck(function(err, checkRes){
            if(err) {Utils.handleError(err); return;}
            if(checkRes === undefined || checkRes.length === 0){
                Utils.alert(getL10n('overview-consistency-is-ok'));
            } else {
                Utils.alert(getL10n('overview-consistency-problem-detected'));
            }
        });
    };
    
    var postLogout = function(){
        document.querySelector('#logoutForm button').click();
    };
    
    var makeButton = function(clazz, name, callback, opts){
        var button = makeEl("button");
        addClass(button, clazz);
        if(opts.tooltip){
            var delegate = function(){
                $(button).attr('data-original-title', L10n.getValue("header-" + name));
            };
            L10n.onL10nChange(delegate);
            $(button).tooltip({
                title : L10n.getValue("header-" + name),
                placement : "bottom"
            });
        }
        addClass(button, "action-button");
        if(opts.className){
            addClass(button, opts.className);
        }
        if(callback){
            listen(button, 'click', callback);
        }
        return button;
    };
    
    var addBeforeUnloadListener = function(){
        window.onbeforeunload = function (evt) {
            var message = getL10n("utils-close-page-warning");
            if (typeof evt == "undefined") {
                evt = window.event;
            }
            if (evt) {
                evt.returnValue = message;
            }
            return message;
        };
    }
    

})(this['PageManager']={});
/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License. */

/*global
 */

"use strict";

(function(exports, mode){

    var state = {};
    
    state.summary = {};
    
    if(mode === "NIMS_Server" && PERMISSION_INFORMER_ENABLED){
        
        exports.refresh = function(callback) {
            callback();
        };
//        exports.refresh = function(callback) {
//            var request = $.ajax({
//                url : "/getPermissionsSummary",
//                dataType : "text",
//                method : "GET",
//                contentType : "application/json;charset=utf-8",
//                timeout: Constants.httpTimeout
//            });
//            
//            request.done(function(data) {
//                state.summary = JSON.parse(data);
//                if(callback){
//                    callback();
//                } else {
//                    exports.subscribe();
//                }
//    //        alert(data);
//    //        alert(state.summary);
//            });
//            
//            request.fail(function(errorInfo, textStatus, errorThrown) {
//                if(callback){
//                    callback(errorInfo.responseText || 'error');
//                } else {
//                    setTimeout(exports.subscribe, 500);
//                }
//            });
//        };
//        
//        exports.subscribe = function() {
//            
//            var request = $.ajax({
//                url : "/subscribeOnPermissionsUpdate",
//                dataType : "text",
//                method : "GET",
//                contentType : "application/json;charset=utf-8",
//                timeout: Constants.httpTimeout
//            });
//            
//            request.done(function(data) {
//                state.summary = JSON.parse(data);
//    //        alert(data);
//    //        alert(state.summary);
//                exports.subscribe();
//            });
//            
//            request.fail(function(errorInfo, textStatus, errorThrown) {
//                setTimeout(exports.subscribe, 500);
//            });
//        };
//        
//        exports.refresh();
    
        exports.isAdmin = function(callback){
            callback(null, state.summary.isAdmin);
        };
        
        exports.isEditor = function(callback){
            callback(null, state.summary.isEditor);
        };
        
        exports.isEntityEditable = function(type, entityName, callback) {
            callback(null, isObjectEditableSync(type, entityName));
        };
        
        var isObjectEditableSync = function(type, name){
            if(state.summary.isEditor){
                return true;
            }
            if(state.summary.existEditor){
                return false;
            }
            return state.summary.user[type].indexOf(name) !== -1;
        };
        
//        exports.getEntityNamesArray = R.curry(function(type, editableOnly, callback){
//            var userEntities = state.summary.user[type];
//            var allEntities = state.summary.all[type];
//            var ownerMap = state.summary.ownerMaps[type];
//            var names = allEntities.filter(function(name){
//                if(editableOnly){
//                    return isObjectEditableSync(type, name);
//                } else {
//                    return true;
//                }
//            }).map(function(name){
//                return {
//                    displayName : ownerMap[name] + ". " + name,
//                    value : name,
//                    editable : isObjectEditableSync(type, name),
//                    isOwner : userEntities.indexOf(name) !== -1
//                };
//            });
//            
//            names.sort(Utils.charOrdAObject);
//            
//            callback(null, names);
//        });
        
        exports.getEntityNamesArray = R.curry(function(type, editableOnly, callback){
            function processNames(err, names){
                if(err) {Utils.handleError(err); return;}
                var newNames = [];
                names.forEach(function(name){
                    newNames.push({
                        displayName:name,
                        value:name,
                        editable: true
                    });
                });
                callback(null, newNames);
            }
            DBMS.getEntityNamesArray(type, processNames);
        });
        
        exports.areAdaptationsEditable = function(adaptations, callback){
            var map = {};
            var isAdaptationRightsByStory = state.summary.isAdaptationRightsByStory;
            
            adaptations.forEach(function(elem){
                var key = elem.storyName + "-" + elem.characterName;
                if(isAdaptationRightsByStory){
                    map[key] = isObjectEditableSync('story', elem.storyName);
                } else {
                    map[key] = isObjectEditableSync('character', elem.characterName);
                }
            });
            
            callback(null, map);
        };
        
    } else if (mode === "Standalone"){
        
        exports.refresh = function(callback) {
            callback();
        };
        
        exports.isAdmin = function(callback){
            callback(null, true);
        };
        
        exports.isEditor = function(callback){
            callback(null, true);
        };
        
        exports.getEntityNamesArray = R.curry(function(type, editableOnly, callback){
            function processNames(err, names){
                if(err) {Utils.handleError(err); return;}
                var newNames = [];
                names.forEach(function(name){
                    newNames.push({
                        displayName:name,
                        value:name,
                        editable: true
                    });
                });
                callback(null, newNames);
            }
            DBMS.getEntityNamesArray(type, processNames);
        });
        
        exports.isEntityEditable = function(type, entityName, callback) {
            callback(null, true);
        };
        
        exports.areAdaptationsEditable = function(adaptations, callback){
            var map = {};
            adaptations.forEach(function(elem){
                map[elem.storyName + "-" + elem.characterName] = true;
            });
            
            callback(null, map);
        };
    }

})(this['PermissionInformer']={}, MODE);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL2RibXMvbG9jYWxEQk1TLmpzIiwianMvZGJtcy9yZW1vdGVEQk1TLmpzIiwiLi4vY29yZS9qcy9maWxlVXRpbHMuanMiLCIuLi9jb3JlL2pzL2wxMG4uanMiLCIuLi9jb3JlL2pzL3VpVXRpbHMuanMiLCIuLi9jb3JlL2pzL3V0aWxzLmpzIiwianMvcGFnZU1hbmFnZXIuanMiLCJqcy9wZXJtaXNzaW9uSW5mb3JtZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcmFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypDb3B5cmlnaHQgMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuIFV0aWxzLCBEYXRhYmFzZSwgTWlncmF0b3JcclxuICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxuZnVuY3Rpb24gbWFrZUxvY2FsREJNUyhmdWxsVmVyc2lvbil7XHJcbi8vICAgIGlmKCFmdWxsVmVyc2lvbil7XHJcbi8vICAgICAgICBmdW5jdGlvbiBMb2NhbERCTVMoKXtcclxuLy8gICAgICAgIH07XHJcbi8vICAgICAgICByZXR1cm4gTG9jYWxEQk1TO1xyXG4vLyAgICB9XHJcbiAgICBcclxuICAgIHZhciBvcHRzID0ge1xyXG4gICAgICAgIE1pZ3JhdG9yICAgICA6IE1pZ3JhdG9yICAgICxcclxuICAgICAgICBDb21tb25VdGlscyAgOiBDb21tb25VdGlscyAsXHJcbiAgICAgICAgRXZlbnRFbWl0dGVyIDogRXZlbnRFbWl0dGVyLFxyXG4gICAgICAgIFIgICAgICAgICAgICA6IFIgICAgICAgICAgICxcclxuICAgICAgICBBanYgICAgICAgICAgOiBBanYgICAgICAgICAsXHJcbiAgICAgICAgU2NoZW1hICAgICAgIDogU2NoZW1hICAgICAgLFxyXG4gICAgICAgIEVycm9ycyAgICAgICA6IEVycm9ycyAgICAgICxcclxuICAgICAgICBsaXN0ZW5lcnMgICAgOiB7fSAgICAgICAgICAsXHJcbiAgICAgICAgQ29uc3RhbnRzICAgIDogQ29uc3RhbnRzICAgLFxyXG4gICAgICAgIGRibXNVdGlscyAgICA6IHt9ICAgICAgICAgICxcclxuICAgICAgICBkYXRlRm9ybWF0ICAgOiBkYXRlRm9ybWF0ICAsXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBMb2NhbERCTVMoKXtcclxuICAgICAgICB0aGlzLl9pbml0KG9wdHMubGlzdGVuZXJzKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIExvY2FsREJNUy5wcm90b3R5cGUuZ2V0U2V0dGluZ3MgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLlNldHRpbmdzO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIGZ1bmMgPSAobmFtZSkgPT4gd2luZG93W25hbWVdKExvY2FsREJNUywgb3B0cyk7XHJcbiAgICBcclxuICAgIFtcImJhc2VBUElcIiAgICAgICAgICAgICAgICxcclxuICAgIFwiY29uc2lzdGVuY3lDaGVja0FQSVwiICAgLFxyXG4gICAgXCJlbnRpdHlBUElcIiAgICAgICAgICAgICAsXHJcbiAgICBcImxvZ0FQSVwiICAgICAgICAgICAgICAgICxcclxuICAgIFwic2hvcEFQSVwiICAgICAgICAgICAgICAgLFxyXG4gICAgXCJhc3NldHNBUElcIiAgICAgICAgICAgICAgICxcclxuICAgIFwiZXh0ZXJuYWxBUElcIiAgICAgICAgICAgICAgICxcclxuLy8gICAgXCJzdGF0aXN0aWNzQVBJXCIgICAgICAgICAsXHJcbi8vICAgIFwicHJvZmlsZXNBUElcIiAgICAgICAgICAgLFxyXG4vLyAgICBcInByb2ZpbGVCaW5kaW5nQVBJXCIgICAgICxcclxuLy9cclxuLy8gICAgXCJwcm9maWxlVmlld0FQSVwiICAgICAgICAsXHJcbi8vICAgIFxyXG4vLyAgICBcImdyb3Vwc0FQSVwiICAgICAgICAgICAgICxcclxuLy8gICAgXCJncm91cFNjaGVtYUFQSVwiICAgICAgICAsXHJcbi8vICAgIFwiaW52ZXN0aWdhdGlvbkJvYXJkQVBJXCIgLFxyXG4vLyAgICBcInJlbGF0aW9uc0FQSVwiICAgICAgICAgICxcclxuLy8gICAgXCJicmllZmluZ0V4cG9ydEFQSVwiICAgICAsXHJcbi8vICAgIFxyXG4vLyAgICBcInByb2ZpbGVDb25maWd1cmVyQVBJXCIgICxcclxuLy8gICAgXCJzdG9yeUJhc2VBUElcIiAgICAgICAgICAsXHJcbi8vICAgIFwic3RvcnlFdmVudHNBUElcIiAgICAgICAgLFxyXG4vLyAgICBcInN0b3J5Q2hhcmFjdGVyc0FQSVwiICAgICxcclxuLy8gICAgXHJcbi8vICAgIFwic3RvcnlWaWV3QVBJXCIgICAgICAgICAgLFxyXG4vLyAgICBcInN0b3J5QWRhcHRhdGlvbnNBUElcIiAgICxcclxuLy8gICAgXCJhY2Nlc3NNYW5hZ2VyQVBJXCIgICAgICAsXHJcbi8vICAgIFwidGV4dFNlYXJjaEFQSVwiICAgICAgICAgLFxyXG4gICAgXS5tYXAoZnVuYyk7XHJcbiAgICBcclxuICAgIExvZ2dlci5hdHRhY2hMb2dDYWxscyhMb2NhbERCTVMsIFIsIGZhbHNlKTtcclxuICAgIHJldHVybiBMb2NhbERCTVM7XHJcbn07XHJcblxyXG5cclxuIiwiLypDb3B5cmlnaHQgMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuIFV0aWxzLCBEYXRhYmFzZVxyXG4gKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgc2hvd05vdGlmaWNhdGlvbiA9IHRydWU7XHJcbmZ1bmN0aW9uIG1ha2VSZW1vdGVEQk1TKExvY2FsREJNUyl7XHJcbiAgICBcclxuLy8gICAgdmFyIHVybCA9IFwiL1wiO1xyXG5cclxuICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHJpbmcoMCwgd2luZG93LmxvY2F0aW9uLmhyZWYubGFzdEluZGV4T2YoJy8nKSsxKTtcclxuLy8gICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gUmVtb3RlREJNUygpe1xyXG4gICAgICAgIHRoaXMuY2xlYXJTZXR0aW5ncygpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgUmVtb3RlREJNUy5fc2ltcGxlR2V0ID0gZnVuY3Rpb24obmFtZSwgcGFyYW1zLCBjYWxsYmFjayl7XHJcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgdmFyIHBhcmFtU3RyID0gXCJcIjtcclxuICAgICAgICBpZihwYXJhbXMpe1xyXG4gICAgICAgICAgICBwYXJhbVN0ciA9IFwiP3BhcmFtcz1cIiArIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsgOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmwgOiB1cmwgKyBuYW1lICsgcGFyYW1TdHIsXHJcbiAgICAgICAgICAgIGRhdGFUeXBlIDogXCJ0ZXh0XCIsXHJcbiAgICAgICAgICAgIG1ldGhvZCA6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlIDogXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLThcIixcclxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxyXG4gICAgICAgICAgICB0aW1lb3V0OiBDb25zdGFudHMuaHR0cFRpbWVvdXQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgSlNPTi5wYXJzZShkYXRhKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKGVycm9ySW5mbywgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKEpTT04ucGFyc2UoZXJyb3JJbmZvLnJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICB9IGNhdGNoKGVycil7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvckluZm8ucmVzcG9uc2VUZXh0IHx8IHRleHRTdGF0dXMgfHwgJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFJlbW90ZURCTVMuX3NpbXBsZVB1dCA9IGZ1bmN0aW9uKG5hbWUsIGRhdGEsIGNhbGxiYWNrKXtcclxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICB2YXIgcmVxdWVzdCA9ICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybCA6IHVybCArIG5hbWUsXHJcbiAgICAgICAgICAgIGRhdGFUeXBlIDogXCJ0ZXh0XCIsXHJcbiAgICAgICAgICAgIG1ldGhvZCA6IFwiUFVUXCIsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlIDogXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLThcIixcclxuICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcbiAgICAgICAgICAgIHRpbWVvdXQ6IENvbnN0YW50cy5odHRwVGltZW91dFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKHNob3dOb3RpZmljYXRpb24pe1xyXG4gICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uQm94ID0gY2xlYXJFbChnZXRFbCgnZGVidWdOb3RpZmljYXRpb24nKSk7XHJcbiAgICAgICAgICAgIHJlbW92ZUNsYXNzKG5vdGlmaWNhdGlvbkJveCwgJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICByZW1vdmVDbGFzcyhub3RpZmljYXRpb25Cb3gsICdvcGVyYXRpb25PSycpO1xyXG4gICAgICAgICAgICByZW1vdmVDbGFzcyhub3RpZmljYXRpb25Cb3gsICdvcGVyYXRpb25GYWlsJyk7XHJcbi8vICAgICAgICAgICAgYWRkRWwobm90aWZpY2F0aW9uQm94LCBtYWtlVGV4dChuYW1lICsgJyAnICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkpKTtcclxuICAgICAgICAgICAgYWRkRWwobm90aWZpY2F0aW9uQm94LCBtYWtlVGV4dChuYW1lKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmKHNob3dOb3RpZmljYXRpb24pe1xyXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3Mobm90aWZpY2F0aW9uQm94LCAnb3BlcmF0aW9uT0snKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhub3RpZmljYXRpb25Cb3gsICdoaWRkZW4nKTtcclxuICAgICAgICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJlcXVlc3QuZmFpbChmdW5jdGlvbihlcnJvckluZm8sIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgICAgIGlmKHNob3dOb3RpZmljYXRpb24pe1xyXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3Mobm90aWZpY2F0aW9uQm94LCAnb3BlcmF0aW9uRmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKG5vdGlmaWNhdGlvbkJveCwgJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKEpTT04ucGFyc2UoZXJyb3JJbmZvLnJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICB9IGNhdGNoKGVycil7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvckluZm8ucmVzcG9uc2VUZXh0IHx8IHRleHRTdGF0dXMgfHwgJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgT2JqZWN0LmtleXMoTG9jYWxEQk1TLnByb3RvdHlwZSkuZm9yRWFjaChmdW5jdGlvbihuYW1lKXtcclxuICAgICAgICBSZW1vdGVEQk1TLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoLTE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goYXJndW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgIGlmKENvbW1vblV0aWxzLnN0YXJ0c1dpdGgobmFtZSwgXCJfXCIpKXtcclxuLy8gICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZyBmb3IgaW5uZXIgZnVuY3Rpb25zXHJcbi8vICAgICAgICAgICAgfSBlbHNlIFxyXG4gICAgICAgICAgICBpZihDb21tb25VdGlscy5zdGFydHNXaXRoKG5hbWUsIFwiZ2V0XCIpIHx8IENvbW1vblV0aWxzLnN0YXJ0c1dpdGgobmFtZSwgXCJpc1wiKSl7XHJcbiAgICAgICAgICAgICAgICBSZW1vdGVEQk1TLl9zaW1wbGVHZXQobmFtZSwgYXJyLCBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aC0xXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdGVEQk1TLl9zaW1wbGVQdXQobmFtZSwgYXJyLCBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aC0xXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBSZW1vdGVEQk1TLnByb3RvdHlwZS5jbGVhclNldHRpbmdzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgdGhpcy5TZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgICAgIFwiQnJpZWZpbmdQcmV2aWV3XCIgOiB7fSxcclxuICAgICAgICAgICAgICAgIFwiU3Rvcmllc1wiIDoge30sXHJcbiAgICAgICAgICAgICAgICBcIlByb2ZpbGVFZGl0b3JcIiA6IHt9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFJlbW90ZURCTVMucHJvdG90eXBlLmdldFNldHRpbmdzID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICByZXR1cm4gdGhpcy5TZXR0aW5ncztcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVtb3RlREJNUztcclxufTtcclxuXHJcblxyXG4iLCIvKkNvcHlyaWdodCAyMDE1LTIwMTcgVGltb2ZleSBSZWNoa2Fsb3YgPG50c2RrQHlhbmRleC5ydT4sIE1hcmlhIFNpZGVraG1lbm92YSA8bWF0aWxkYV9AbGlzdC5ydT5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG5odHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4gKi9cclxuXHJcbi8qZ2xvYmFsXHJcbiBVdGlscywgc2F2ZUFzLCBGaWxlUmVhZGVyLCBCbG9iXHJcbiAqL1xyXG5cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgRmlsZVV0aWxzID0ge307XHJcblxyXG5GaWxlVXRpbHMuaW5pdCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBGaWxlVXRpbHMuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxufTtcclxuXHJcbkZpbGVVdGlscy5tYWtlTmV3QmFzZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgVXRpbHMuY29uZmlybShnZXRMMTBuKFwidXRpbHMtbmV3LWJhc2Utd2FybmluZ1wiKSwgKCkgPT4ge1xyXG4gICAgICAgIERCTVMuc2V0RGF0YWJhc2UoQ29tbW9uVXRpbHMuY2xvbmUoRW1wdHlCYXNlLmRhdGEpLCBGaWxlVXRpbHMuY2FsbGJhY2spO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5GaWxlVXRpbHMub3BlbkhlbHAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHdpbmRvdy5vcGVuKFwiZXh0cmFzL2RvYy9uaW1zLmh0bWxcIik7XHJcbn07XHJcblxyXG5GaWxlVXRpbHMucmVhZFNpbmdsZUZpbGUgPSBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIC8vIFJldHJpZXZlIHRoZSBmaXJzdCAoYW5kIG9ubHkhKSBGaWxlIGZyb20gdGhlIEZpbGVMaXN0IG9iamVjdFxyXG4gICAgdmFyIGYgPSBldnQudGFyZ2V0LmZpbGVzWzBdO1xyXG5cclxuICAgIGlmIChmKSB7XHJcbiAgICAgICAgdmFyIHIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgIHIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICB2YXIgZGF0YWJhc2UgPSBKU09OLnBhcnNlKGNvbnRlbnRzKTtcclxuICAgICAgICAgICAgREJNUy5zZXREYXRhYmFzZShkYXRhYmFzZSwgRmlsZVV0aWxzLmNhbGxiYWNrKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHIucmVhZEFzVGV4dChmKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgVXRpbHMuYWxlcnQoZ2V0TDEwbihcInV0aWxzLWJhc2UtZmlsZS1sb2FkaW5nLWVycm9yXCIpKTtcclxuICAgIH1cclxufTtcclxuXHJcbkZpbGVVdGlscy5zYXZlRmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgREJNUy5nZXREYXRhYmFzZShmdW5jdGlvbihlcnIsIGRhdGFiYXNlKXtcclxuICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgIEZpbGVVdGlscy5qc29uMkZpbGUoZGF0YWJhc2UsIFwibmltcy1iYXNlLmpzb25cIik7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkZpbGVVdGlscy5qc29uMkZpbGUgPSBmdW5jdGlvbiAoc3RyLCBmaWxlTmFtZSkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBGaWxlVXRpbHMuc3RyMkZpbGUoSlNPTi5zdHJpbmdpZnkoc3RyLCBudWxsLCAnICAnKSwgZmlsZU5hbWUpO1xyXG59O1xyXG5cclxuRmlsZVV0aWxzLnN0cjJGaWxlID0gZnVuY3Rpb24gKHN0ciwgZmlsZU5hbWUpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbIHN0ciBdLCB7XHJcbiAgICAgICAgdHlwZSA6IFwidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04XCJcclxuICAgIH0pO1xyXG4gICAgc2F2ZUFzKGJsb2IsIGZpbGVOYW1lKTtcclxufTtcclxuXHJcbiIsIi8qQ29weXJpZ2h0IDIwMTUtMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PiwgTWFyaWEgU2lkZWtobWVub3ZhIDxtYXRpbGRhX0BsaXN0LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuICovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbihmdW5jdGlvbihleHBvcnRzLCBEaWN0aW9uYXJpZXMpe1xyXG5cclxuICAgIHZhciBzdGF0ZSA9IHt9O1xyXG4gICAgXHJcbiAgICBzdGF0ZS5pbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgc3RhdGUubDEwbkRlbGVnYXRlcyA9IFtdO1xyXG4gICAgc3RhdGUuZGljdGlvbmFyaWVzID0ge307XHJcbiAgICBzdGF0ZS5sYW5nID0gZGVmYXVsdExhbmc7XHJcbiAgICBcclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBpZihzdGF0ZS5pbml0aWFsaXplZCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbi8vICAgICAgICBjb25zb2xlLmxvZyhuYXZpZ2F0b3IubGFuZ3VhZ2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvcih2YXIgbmFtZSBpbiBEaWN0aW9uYXJpZXMpe1xyXG4gICAgICAgICAgICBzdGF0ZS5kaWN0aW9uYXJpZXNbbmFtZV0gPSBwcm9jZXNzRGljdGlvbmFyeShEaWN0aW9uYXJpZXNbbmFtZV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIC8vICAgIHZhciBsYW5nID0gKG5hdmlnYXRvci5sYW5ndWFnZXMgPyBuYXZpZ2F0b3IubGFuZ3VhZ2VzWzBdIDogbmF2aWdhdG9yLmJyb3dzZXJMYW5ndWFnZSkuc3BsaXQoJy0nKVswXTtcclxuICAgIC8vICAgIHZhciBsYW5nID0gJ3J1JztcclxuLy8gICAgICAgIHZhciBsYW5nID0gZGVmYXVsdExhbmc7XHJcbi8vICAgICAgICBjb25zb2xlLmxvZyhsYW5nKTtcclxuICAgICAgICBcclxuICAgICAgICBpZihzdGF0ZS5kaWN0aW9uYXJpZXNbZGVmYXVsdExhbmddKXtcclxuICAgICAgICAgICAgc3RhdGUuZGljdCA9IHN0YXRlLmRpY3Rpb25hcmllc1tkZWZhdWx0TGFuZ107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc3RhdGUuZGljdCA9IHN0YXRlLmRpY3Rpb25hcmllc1snZW4nXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0SHRtbExhbmcoZGVmYXVsdExhbmcpO1xyXG4gICAgICAgIGV4cG9ydHMub25MMTBuQ2hhbmdlKGV4cG9ydHMubG9jYWxpemVTdGF0aWMpO1xyXG4gICAgICAgIHN0YXRlLmluaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHZhciBwcm9jZXNzRGljdGlvbmFyeSA9IGZ1bmN0aW9uKGRpY3Rpb25hcnkpe1xyXG4gICAgICAgIHZhciBwcm9jZXNzZWREaWN0aW9uYXJ5ID0ge307XHJcbiAgICAgICAgZm9yKHZhciBzZWN0aW9uTmFtZSBpbiBkaWN0aW9uYXJ5KXtcclxuICAgICAgICAgICAgZm9yKHZhciBuYW1lIGluIGRpY3Rpb25hcnlbc2VjdGlvbk5hbWVdKXtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3NlZERpY3Rpb25hcnlbc2VjdGlvbk5hbWUrXCItXCIrbmFtZV0gPSBkaWN0aW9uYXJ5W3NlY3Rpb25OYW1lXVtuYW1lXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZERpY3Rpb25hcnk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB2YXIgc2V0SHRtbExhbmcgPSAobGFuZykgPT4gc2V0QXR0cihkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImh0bWxcIilbMF0sJ2xhbmcnLCBsYW5nKTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy50b2dnbGVMMTBuID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBpZihzdGF0ZS5sYW5nID09PSBcInJ1XCIpe1xyXG4gICAgICAgICAgICBzdGF0ZS5kaWN0ID0gc3RhdGUuZGljdGlvbmFyaWVzWydlbiddO1xyXG4gICAgICAgICAgICBzdGF0ZS5sYW5nID0gXCJlblwiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0YXRlLmRpY3QgPSBzdGF0ZS5kaWN0aW9uYXJpZXNbJ3J1J107XHJcbiAgICAgICAgICAgIHN0YXRlLmxhbmcgPSBcInJ1XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldEh0bWxMYW5nKHN0YXRlLmxhbmcpO1xyXG4gICAgICAgIHN0YXRlLmwxMG5EZWxlZ2F0ZXMuZm9yRWFjaChmdW5jdGlvbihkZWxlZ2F0ZSl7XHJcbiAgICAgICAgICAgIGRlbGVnYXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLmdldExhbmcgPSAoKSA9PiBzdGF0ZS5sYW5nLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBcclxuICAgIGV4cG9ydHMuZm9ybWF0ID0gUi5jdXJyeShmdW5jdGlvbihuYW1lc3BhY2UsIG5hbWUsIGFyZ3Mpe1xyXG4gICAgICAgIHJldHVybiBzdHJGb3JtYXQoZXhwb3J0cy5nZXQobmFtZXNwYWNlLCBuYW1lKSwgYXJncyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBleHBvcnRzLmdldCA9IFIuY3VycnkoZnVuY3Rpb24obmFtZXNwYWNlLCBuYW1lKXtcclxuICAgICAgICByZXR1cm4gTDEwbi5nZXRWYWx1ZShuYW1lc3BhY2UgKyAnLScgKyBuYW1lKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBleHBvcnRzLmdldFZhbHVlID0gZnVuY3Rpb24obmFtZSl7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gc3RhdGUuZGljdFtuYW1lXTtcclxuICAgICAgICBpZih2YWx1ZSA9PT0gdW5kZWZpbmVkKSBjb25zb2xlLmxvZyhcIlZhbHVlIGlzIG5vdCBmb3VuZDogXCIgKyBuYW1lKTtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZSA6IG5hbWUgKyBcIjpSQSBSQS1BSC1BSC1BSCBST01BIFJPTUEtTUEgR0FHQSBPSCBMQS1MQVwiO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5vbkwxMG5DaGFuZ2UgPSBmdW5jdGlvbihkZWxlZ2F0ZSl7XHJcbiAgICAgICAgc3RhdGUubDEwbkRlbGVnYXRlcy5wdXNoKGRlbGVnYXRlKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMubG9jYWxpemVTdGF0aWMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIGluaXQoKTtcclxuICAgICAgICBubDJhcnJheShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2wxMG4taWRdXCIpKS5tYXAoZWwgPT4gYWRkRWwoY2xlYXJFbChlbCksIG1ha2VUZXh0KGV4cG9ydHMuZ2V0VmFsdWUoZ2V0QXR0cihlbCxcImwxMG4taWRcIikpKSkpO1xyXG4gICAgICAgIG5sMmFycmF5KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbDEwbi1wbGFjZWhvbGRlci1pZF1cIikpLm1hcChlbCA9PiBzZXRBdHRyKGVsLFwicGxhY2Vob2xkZXJcIiwgZXhwb3J0cy5nZXRWYWx1ZShnZXRBdHRyKGVsLFwibDEwbi1wbGFjZWhvbGRlci1pZFwiKSkpKTtcclxuICAgIH07XHJcblxyXG59KSh0aGlzWydMMTBuJ109e30sIERpY3Rpb25hcmllcyk7IiwiLypDb3B5cmlnaHQgMjAxNS0yMDE3IFRpbW9mZXkgUmVjaGthbG92IDxudHNka0B5YW5kZXgucnU+LCBNYXJpYSBTaWRla2htZW5vdmEgPG1hdGlsZGFfQGxpc3QucnU+XHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuICovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbihmdW5jdGlvbihleHBvcnRzKXtcclxuXHJcbiAgICBleHBvcnRzLmluaXRUYWJQYW5lbCA9IGZ1bmN0aW9uKHRhYkNsYXp6LCBjb250YWluZXJDbGF6eikge1xyXG4gICAgICAgIHZhciBjb250YWluZXJzID0gZ2V0RWxzKGNvbnRhaW5lckNsYXp6KTtcclxuICAgIFxyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIGZvciAoaSA9IDE7IGkgPCBjb250YWluZXJzLmxlbmd0aDsgaSsrKSB7IC8vIGRvbid0IGhpZGUgMXN0IGVsZW1lbnRcclxuICAgICAgICAgICAgYWRkQ2xhc3MoY29udGFpbmVyc1tpXSwgXCJoaWRkZW5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgdmFyIHRhYkJ1dHRvbnMgPSBnZXRFbHModGFiQ2xhenopO1xyXG4gICAgXHJcbiAgICAgICAgYWRkQ2xhc3ModGFiQnV0dG9uc1swXSwgXCJhY3RpdmVcIik7XHJcbiAgICBcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFiQnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsaXN0ZW4odGFiQnV0dG9uc1tpXSwgXCJjbGlja1wiLCB0YWJCdXR0b25DbGljayh0YWJCdXR0b25zLCBjb250YWluZXJzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIHRhYkJ1dHRvbkNsaWNrID0gZnVuY3Rpb24oYnV0dG9ucywgY29udGFpbmVycykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHNldENsYXNzQnlDb25kaXRpb24oYnV0dG9uc1tpXSwgXCJhY3RpdmVcIiwgZXZlbnQudGFyZ2V0LmlkID09PSBidXR0b25zW2ldLmlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbnRhaW5lcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHNldENsYXNzQnlDb25kaXRpb24oY29udGFpbmVyc1tpXSwgXCJoaWRkZW5cIiwgZXZlbnQudGFyZ2V0LmlkICsgXCJDb250YWluZXJcIiAhPT0gY29udGFpbmVyc1tpXS5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5maWxsU2hvd0l0ZW1TZWxlY3RvciA9IGZ1bmN0aW9uIChzZWxlY3RvciwgZGlzcGxheUFycmF5KSB7XHJcbiAgICAgICAgdmFyIGVsO1xyXG4gICAgICAgIHNldEF0dHIoc2VsZWN0b3IsIFwic2l6ZVwiLCBkaXNwbGF5QXJyYXkubGVuZ3RoKTtcclxuICAgICAgICBkaXNwbGF5QXJyYXkuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgICBlbCA9IHNldFByb3BzKG1ha2VFbChcIm9wdGlvblwiKSwge1xyXG4gICAgICAgICAgICAgICAgXCJzZWxlY3RlZFwiIDogdHJ1ZSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHNldENsYXNzQnlDb25kaXRpb24oZWwsICdoaWRkZW4nLCB2YWx1ZS5oaWRkZW4pO1xyXG4gICAgICAgICAgICBhZGRFbChzZWxlY3RvciwgYWRkRWwoZWwsIG1ha2VUZXh0KHZhbHVlLm5hbWUpKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLmZpbGxTaG93SXRlbVNlbGVjdG9yMiA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgb3B0aW9uR3JvdXBzKSB7XHJcbiAgICAgICAgdmFyIGVsLCBncm91cEVsLCBjb3VudGVyID0gMDtcclxuICAgICAgICBhZGRFbHMoc2VsZWN0b3IsIG9wdGlvbkdyb3Vwcy5tYXAoZnVuY3Rpb24oZ3JvdXApIHtcclxuICAgICAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgICAgICBncm91cEVsID0gc2V0QXR0cihtYWtlRWwoXCJvcHRncm91cFwiKSwgJ2xhYmVsJywgZ3JvdXAubmFtZSk7XHJcbiAgICAgICAgICAgIGFkZEVscyhncm91cEVsLCBncm91cC5hcnJheS5tYXAoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlbCA9IHNldFByb3BzKG1ha2VFbChcIm9wdGlvblwiKSwge1xyXG4gICAgICAgICAgICAgICAgICAgIFwic2VsZWN0ZWRcIiA6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHNldENsYXNzQnlDb25kaXRpb24oZWwsICdoaWRkZW4nLCB2YWx1ZS5oaWRkZW4pO1xyXG4gICAgICAgICAgICAgICAgY291bnRlciArPSAodmFsdWUuaGlkZGVuID8gMCA6IDEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFkZEVsKGVsLCBtYWtlVGV4dCh2YWx1ZS5uYW1lKSk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwRWw7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHNldEF0dHIoc2VsZWN0b3IsIFwic2l6ZVwiLCBjb3VudGVyKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMuc2hvd1NlbGVjdGVkRWxzID0gZnVuY3Rpb24oY2xhc3NLZXkpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgIHZhciBlbCA9IGV2ZW50LnRhcmdldDtcclxuICAgICAgICAgICAgdmFyIGVscywgaSwgajtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsLm9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIGVscyA9IGdldEVscyhpICsgY2xhc3NLZXkpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGVscy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldENsYXNzQnlDb25kaXRpb24oZWxzW2pdLCBcImhpZGRlblwiLCAhZWwub3B0aW9uc1tpXS5zZWxlY3RlZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLmluaXRTZWxlY3RvckZpbHRlcnMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBlbGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbc2VsZWN0b3ItZmlsdGVyXVwiKTtcclxuICAgICAgICB2YXIgZWwsIHNlbDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGVsID0gZWxlbXNbaV07XHJcbiAgICAgICAgICAgIHNlbCA9IHF1ZXJ5RWwoZ2V0QXR0cihlbCxcInNlbGVjdG9yLWZpbHRlclwiKSk7XHJcbiAgICAgICAgICAgIGVsLnZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgIGxpc3RlbihlbCwgXCJpbnB1dFwiLCBmaWx0ZXJPcHRpb25zKHNlbCkpXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIGZpbHRlck9wdGlvbnMgPSBmdW5jdGlvbihzZWwpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgIHZhciB2YWwgPSBldmVudC50YXJnZXQudmFsdWU7XHJcbiAgICAgICAgICAgIHZhciBpLCBvcHQ7XHJcbiAgICAgICAgICAgIHZhbCA9IENvbW1vblV0aWxzLmdsb2JTdHJpbmdUb1JlZ2V4KHZhbC50cmltKCkudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWwub3B0aW9ucy5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgb3B0ID0gc2VsLm9wdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgaXNWaXNpYmxlID0gb3B0LmlubmVySFRNTC50b0xvd2VyQ2FzZSgpLnNlYXJjaCh2YWwpICE9PSAtMTtcclxuICAgICAgICAgICAgICAgIGlmKCFpc1Zpc2libGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdC5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2V0Q2xhc3NCeUNvbmRpdGlvbihvcHQsIFwiaGlkZGVuXCIsICFpc1Zpc2libGUpO1xyXG4vLyAgICAgICAgICAgICAgICBzZXRDbGFzc0J5Q29uZGl0aW9uKG9wdCwgXCJoaWRkZW5cIiwgb3B0LmlubmVySFRNTC50b0xvd2VyQ2FzZSgpLnNlYXJjaCh2YWwpID09PSAtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2VsLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5pbml0UGFuZWxUb2dnbGVycyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIGVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltwYW5lbC10b2dnbGVyXVwiKTtcclxuICAgICAgICB2YXIgZWwsIHNlbCwgYXR0cjtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGVsID0gZWxlbXNbaV07XHJcbiAgICAgICAgICAgIGF0dHIgPSBnZXRBdHRyKGVsLFwicGFuZWwtdG9nZ2xlclwiKTtcclxuICAgICAgICAgICAgc2VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdHRyKTtcclxuICAgICAgICAgICAgaWYoc2VsID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgVXRpbHMuYWxlcnQoXCJQYW5lbCB0b2dnbGVyIGlzIGJyb2tlbjogXCIgKyBhdHRyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsaXN0ZW4oZWwsIFwiY2xpY2tcIiwgZXhwb3J0cy50b2dnbGVQYW5lbChzZWwpKVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMudG9nZ2xlUGFuZWwgPSBmdW5jdGlvbihzZWwpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHNlbCwgXCJoaWRkZW5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5tYWtlRXZlbnRUaW1lUGlja2VyID0gZnVuY3Rpb24gKG9wdHMpIHtcclxuICAgICAgICB2YXIgaW5wdXQgPSBtYWtlRWwoXCJpbnB1dFwiKTtcclxuICAgICAgICBSLmFwKFthZGRDbGFzcyhpbnB1dCldLCBvcHRzLmV4dHJhQ2xhc3Nlcyk7XHJcbiAgICAgICAgYWRkQ2xhc3MoaW5wdXQsIFwiZXZlbnRUaW1lXCIpO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gb3B0cy5ldmVudFRpbWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaW5wdXQuZXZlbnRJbmRleCA9IG9wdHMuaW5kZXg7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIHBpY2tlck9wdHMgPSB7XHJcbiAgICAgICAgICAgIGxhbmcgOiBMMTBuLmdldExhbmcoKSxcclxuICAgICAgICAgICAgbWFzayA6IHRydWUsXHJcbiAgICAgICAgICAgIHN0YXJ0RGF0ZSA6IG5ldyBEYXRlKG9wdHMucHJlR2FtZURhdGUpLFxyXG4gICAgICAgICAgICBlbmREYXRlIDogbmV3IERhdGUob3B0cy5kYXRlKSxcclxuICAgICAgICAgICAgb25DaGFuZ2VEYXRlVGltZSA6IG9wdHMub25DaGFuZ2VEYXRlVGltZUNyZWF0b3IoaW5wdXQpLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKG9wdHMuZXZlbnRUaW1lICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHBpY2tlck9wdHMudmFsdWUgPSBvcHRzLmV2ZW50VGltZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwaWNrZXJPcHRzLnZhbHVlID0gb3B0cy5kYXRlO1xyXG4gICAgICAgICAgICBhZGRDbGFzcyhpbnB1dCwgXCJkZWZhdWx0RGF0ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgalF1ZXJ5KGlucHV0KS5kYXRldGltZXBpY2tlcihwaWNrZXJPcHRzKTtcclxuICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBidWcgYWJvdXQgc2V0dGluZyAwOTAwIHllYXJzIGluIEJyYWF2b3MgZ2FtZSBpcyBldmVudCBkYXRlLiBGaXhlZCBpbiBwcm9kdWN0aW9uLlxyXG4vLyAgZXhwb3J0cy5tYWtlRXZlbnRUaW1lUGlja2VyID0gZnVuY3Rpb24gKG9wdHMpIHtcclxuLy8gICAgICB2YXIgaW5wdXQgPSBtYWtlRWwoXCJpbnB1dFwiKTtcclxuLy8gICAgICBSLmFwKFthZGRDbGFzcyhpbnB1dCldLCBvcHRzLmV4dHJhQ2xhc3Nlcyk7XHJcbi8vICAgICAgYWRkQ2xhc3MoaW5wdXQsIFwiZXZlbnRUaW1lXCIpO1xyXG4vLyAgICAgIGlucHV0LnZhbHVlID0gb3B0cy5ldmVudFRpbWU7XHJcbi8vICAgICAgXHJcbi8vICAgICAgaW5wdXQuZXZlbnRJbmRleCA9IG9wdHMuaW5kZXg7XHJcbi8vICAgICAgXHJcbi8vICAgICAgdmFyIHBpY2tlck9wdHMgPSB7XHJcbi8vICAgICAgICAgIGxhbmcgOiBMMTBuLmdldExhbmcoKSxcclxuLy8gICAgICAgICAgbWFzayA6IHRydWUsXHJcbi8vICAgICAgICAgIHN0YXJ0RGF0ZSA6IG5ldyBEYXRlKG9wdHMucHJlR2FtZURhdGUpLFxyXG4vLyAgICAgICAgICBlbmREYXRlIDogbmV3IERhdGUob3B0cy5kYXRlKSxcclxuLy8gICAgICAgICAgb25DaGFuZ2VEYXRlVGltZSA6IG9wdHMub25DaGFuZ2VEYXRlVGltZUNyZWF0b3IoaW5wdXQpLFxyXG4vLyAgICAgIH07XHJcbi8vICAgICAgXHJcbi8vICAgICAgdmFyIHBpY2tlciA9IGpRdWVyeShpbnB1dCkuZGF0ZXRpbWVwaWNrZXIocGlja2VyT3B0cyk7XHJcbi8vICAgICAgXHJcbi8vICAgICAgdmFyIHZhbHVlO1xyXG4vLyAgICAgIGlmIChvcHRzLmV2ZW50VGltZSAhPT0gXCJcIikge1xyXG4vLyAgICAgICAgICB2YWx1ZSA9IG5ldyBEYXRlKG9wdHMuZXZlbnRUaW1lKTtcclxuLy8gICAgICB9IGVsc2Uge1xyXG4vLyAgICAgICAgICB2YWx1ZSA9IG9wdHMuZGF0ZTtcclxuLy8gICAgICAgICAgYWRkQ2xhc3MoaW5wdXQsIFwiZGVmYXVsdERhdGVcIik7XHJcbi8vICAgICAgfVxyXG4vLyAgICAgIFxyXG4vLyAgICAgIHBpY2tlci52YWx1ZSA9IHZhbHVlO1xyXG4vLyAgICAgIFxyXG4vLyAgICAgIFxyXG4vLyAgICAgIHJldHVybiBpbnB1dDtcclxuLy8gIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMucmVzaXplVGV4dGFyZWEgPSBmdW5jdGlvbiAoZXYpIHtcclxuICAgICAgICB2YXIgdGhhdCA9IGV2LnRhcmdldDtcclxuICAgICAgICB0aGF0LnN0eWxlLmhlaWdodCA9ICcyNHB4JztcclxuICAgICAgICB0aGF0LnN0eWxlLmhlaWdodCA9IHRoYXQuc2Nyb2xsSGVpZ2h0ICsgMTIgKyAncHgnO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5yZXNpemVUZXh0YXJlYTIgPSBmdW5jdGlvbiAodGhhdCkge1xyXG4gICAgICAgIHRoYXQuc3R5bGUuaGVpZ2h0ID0gJzI0cHgnO1xyXG4gICAgICAgIHRoYXQuc3R5bGUuaGVpZ2h0ID0gdGhhdC5zY3JvbGxIZWlnaHQgKyAxMiArICdweCc7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLm1ha2VBZGFwdGF0aW9uVGltZUlucHV0ID0gZnVuY3Rpb24oc3RvcnlOYW1lLCBldmVudCwgY2hhcmFjdGVyTmFtZSwgaXNFZGl0YWJsZSl7XHJcbiAgICAgICAgdmFyIGlucHV0ID0gbWFrZUVsKFwiaW5wdXRcIik7XHJcbiAgICAgICAgc2V0Q2xhc3NCeUNvbmRpdGlvbihpbnB1dCwgXCJub3RFZGl0YWJsZVwiLCAhaXNFZGl0YWJsZSk7XHJcbiAgICAgICAgYWRkQ2xhc3MoaW5wdXQsXCJhZGFwdGF0aW9uVGltZUlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gZXZlbnQuY2hhcmFjdGVyc1tjaGFyYWN0ZXJOYW1lXS50aW1lO1xyXG4gICAgICAgIGlucHV0LmRhdGFLZXkgPSBKU09OLnN0cmluZ2lmeShbc3RvcnlOYW1lLCBldmVudC5pbmRleCwgY2hhcmFjdGVyTmFtZV0pO1xyXG4gICAgICAgIGxpc3RlbihpbnB1dCwgXCJjaGFuZ2VcIiwgb25DaGFuZ2VQZXJzb25hbFRpbWVEZWxlZ2F0ZSk7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIG9uQ2hhbmdlUGVyc29uYWxUaW1lRGVsZWdhdGUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgZGF0YUtleSA9IEpTT04ucGFyc2UoZXZlbnQudGFyZ2V0LmRhdGFLZXkpO1xyXG4gICAgICAgIHZhciB0aW1lID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgIERCTVMuc2V0RXZlbnRBZGFwdGF0aW9uUHJvcGVydHkoZGF0YUtleVswXSwgZGF0YUtleVsxXSwgZGF0YUtleVsyXSwgJ3RpbWUnLCB0aW1lLCBVdGlscy5wcm9jZXNzRXJyb3IoKSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLm1ha2VBZGFwdGF0aW9uUmVhZHlJbnB1dCA9IGZ1bmN0aW9uKHN0b3J5TmFtZSwgZXZlbnQsIGNoYXJhY3Rlck5hbWUsIGlzRWRpdGFibGUpe1xyXG4gICAgICAgIHZhciBkaXYgPSBtYWtlRWwoXCJkaXZcIik7XHJcbiAgICAgICAgdmFyIGlucHV0ID0gbWFrZUVsKFwiaW5wdXRcIik7XHJcbiAgICAgICAgc2V0Q2xhc3NCeUNvbmRpdGlvbihpbnB1dCwgXCJub3RFZGl0YWJsZVwiLCAhaXNFZGl0YWJsZSk7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwiY2hlY2tib3hcIjtcclxuICAgICAgICBpbnB1dC5jaGVja2VkID0gZXZlbnQuY2hhcmFjdGVyc1tjaGFyYWN0ZXJOYW1lXS5yZWFkeTtcclxuICAgICAgICBpbnB1dC5kYXRhS2V5ID0gSlNPTi5zdHJpbmdpZnkoW3N0b3J5TmFtZSwgZXZlbnQuaW5kZXgsIGNoYXJhY3Rlck5hbWVdKTtcclxuICAgICAgICBpbnB1dC5pZCA9IGV2ZW50LmluZGV4ICsgXCItXCIgKyBzdG9yeU5hbWUgKyBcIi1cIiArIGNoYXJhY3Rlck5hbWU7XHJcbiAgICAgICAgbGlzdGVuKGlucHV0LCBcImNoYW5nZVwiLCBvbkNoYW5nZVJlYWR5U3RhdHVzKTtcclxuICAgICAgICBhZGRFbChkaXYsIGlucHV0KTtcclxuICAgICAgICBcclxuICAgICAgICBhZGRFbChkaXYsIHNldEF0dHIoYWRkRWwobWFrZUVsKFwibGFiZWxcIiksIG1ha2VUZXh0KGNvbnN0TDEwbihDb25zdGFudHMuZmluaXNoZWRUZXh0KSkpLCBcImZvclwiLCBpbnB1dC5pZCkpO1xyXG4gICAgICAgIHJldHVybiBkaXY7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB2YXIgb25DaGFuZ2VSZWFkeVN0YXR1cyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBkYXRhS2V5ID0gSlNPTi5wYXJzZShldmVudC50YXJnZXQuZGF0YUtleSk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZXZlbnQudGFyZ2V0LmNoZWNrZWQ7XHJcbiAgICAgICAgREJNUy5zZXRFdmVudEFkYXB0YXRpb25Qcm9wZXJ0eShkYXRhS2V5WzBdLCBkYXRhS2V5WzFdLCBkYXRhS2V5WzJdLCAncmVhZHknLCB2YWx1ZSwgVXRpbHMucHJvY2Vzc0Vycm9yKCkpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5tYWtlUGFuZWxDb3JlID0gZnVuY3Rpb24odGl0bGUsIGNvbnRlbnQpe1xyXG4gICAgICAgIHZhciBwYW5lbCA9IGFkZENsYXNzZXMobWFrZUVsKCdkaXYnKSwgW1wicGFuZWxcIiwgXCJwYW5lbC1kZWZhdWx0XCJdKTtcclxuICAgICAgICB2YXIgaDMgPSBhZGRDbGFzcyhhZGRFbChtYWtlRWwoJ2gzJyksIHRpdGxlKSwgXCJwYW5lbC10aXRsZVwiKTtcclxuICAgICAgICB2YXIgYSA9IHNldEF0dHIobWFrZUVsKCdhJyksJ2hyZWYnLCcjLycpO1xyXG4gICAgICAgIHZhciBoZWFkRGl2ID0gYWRkQ2xhc3MobWFrZUVsKCdkaXYnKSwgXCJwYW5lbC1oZWFkaW5nXCIpO1xyXG4gICAgICAgIGFkZEVsKHBhbmVsLCBhZGRFbChoZWFkRGl2LCBhZGRFbChhLCBoMykpKTtcclxuICAgICAgICB2YXIgY29udGVudERpdiA9IGFkZENsYXNzKG1ha2VFbCgnZGl2JyksIFwicGFuZWwtYm9keVwiKTtcclxuICAgICAgICBhZGRFbChwYW5lbCwgYWRkRWwoY29udGVudERpdiwgY29udGVudCkpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHBhbmVsOiBwYW5lbCxcclxuICAgICAgICAgICAgY29udGVudERpdjogY29udGVudERpdixcclxuICAgICAgICAgICAgYTogYVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBleHBvcnRzLm1ha2VQcm9maWxlVGFibGUgPSBmdW5jdGlvbihwcm9maWxlU3RydWN0dXJlLCBwcm9maWxlKXtcclxuICAgICAgICB2YXIgdmFsdWU7XHJcbiAgICAgICAgdmFyIHByb2ZpbGVEaXYgPSBhZGRFbHMobWFrZUVsKCd0Ym9keScpLCBwcm9maWxlU3RydWN0dXJlLmZpbHRlcihlbGVtZW50ID0+IGVsZW1lbnQuZG9FeHBvcnQpLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwidGV4dFwiOlxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBhZGRDbGFzcyhtYWtlRWwoXCJzcGFuXCIpLCBcImJyaWVmaW5nVGV4dFNwYW5cIik7XHJcbiAgICAgICAgICAgICAgICBhZGRFbCh2YWx1ZSwgbWFrZVRleHQocHJvZmlsZVtlbGVtZW50Lm5hbWVdKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImVudW1cIjpcclxuICAgICAgICAgICAgY2FzZSBcIm11bHRpRW51bVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gbWFrZVRleHQocHJvZmlsZVtlbGVtZW50Lm5hbWVdKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiY2hlY2tib3hcIjpcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gbWFrZVRleHQoY29uc3RMMTBuKENvbnN0YW50c1twcm9maWxlW2VsZW1lbnQubmFtZV1dKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCB0eXBlICcgKyBlbGVtZW50LnR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLm1ha2VUYWJsZVJvdyhtYWtlVGV4dChlbGVtZW50Lm5hbWUpLCB2YWx1ZSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHJldHVybiBhZGRFbChhZGRDbGFzc2VzKG1ha2VFbCgndGFibGUnKSwgWyd0YWJsZScsJ3RhYmxlLXN0cmlwZWQnXSksIHByb2ZpbGVEaXYpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZXhwb3J0cy5tYWtlVGFibGVSb3cgPSBmdW5jdGlvbihjb2wxLCBjb2wyKXtcclxuICAgICAgICByZXR1cm4gYWRkRWxzKG1ha2VFbCgndHInKSwgW2FkZEVsKG1ha2VFbCgndGQnKSwgY29sMSksIGFkZEVsKG1ha2VFbCgndGQnKSxjb2wyKV0pO1xyXG4gICAgfTtcclxuXHJcbn0pKHRoaXNbJ1VJJ109e30pOyIsIi8qQ29weXJpZ2h0IDIwMTUtMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PiwgTWFyaWEgU2lkZWtobWVub3ZhIDxtYXRpbGRhX0BsaXN0LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgVXRpbHMgPSB7fTtcclxuXHJcbi8qKiBvcHRzXHJcbiAqICAgICAgdG9vbHRpcCAtIGFkZCB0b29sdGlwIHRvIGJ1dHRvbiwgdXNlZCBmb3IgaWNvbmljIGJ1dHRvbnNcclxuICogICAgICBpZCAtIHNldCBidXR0b24gaWRcclxuICogICAgICBtYWluUGFnZSAtIGVuYWJsZSB2aWV3IGFzIGZpcnN0IHBhZ2VcclxuICogICAgICB0b2dnbGUgLSB0b2dnbGUgY29udGVudCwgYXNzb2NpYXRlZCB3aXRoIGJ1dHRvblxyXG4gKi9cclxuVXRpbHMuYWRkVmlldyA9IGZ1bmN0aW9uIChjb250YWluZXJzLCBuYW1lLCB2aWV3LCBvcHRzKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHZhciBvcHRzID0gb3B0cyB8fCB7fTtcclxuICAgIHZpZXcuaW5pdCgpO1xyXG4gICAgdmFyIGJ1dHRvbkNsYXNzID0gXCJuYXZpZ2F0aW9uLWJ1dHRvblwiO1xyXG4gICAgY29udGFpbmVycy5yb290LnZpZXdzW25hbWVdID0gdmlldztcclxuICAgIHZhciBidXR0b24gPSBtYWtlRWwoXCJidXR0b25cIik7XHJcbiAgICBpZihvcHRzLnRvb2x0aXApe1xyXG4gICAgICAgIHZhciBkZWxlZ2F0ZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICQoYnV0dG9uKS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgTDEwbi5nZXRWYWx1ZShcImhlYWRlci1cIiArIG5hbWUpKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIEwxMG4ub25MMTBuQ2hhbmdlKGRlbGVnYXRlKTtcclxuICAgICAgICAkKGJ1dHRvbikudG9vbHRpcCh7XHJcbiAgICAgICAgICAgIHRpdGxlIDogTDEwbi5nZXRWYWx1ZShcImhlYWRlci1cIiArIG5hbWUpLFxyXG4gICAgICAgICAgICBwbGFjZW1lbnQgOiBcImJvdHRvbVwiXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFkZEVsKGJ1dHRvbiwgbWFrZVRleHQoTDEwbi5nZXRWYWx1ZShcImhlYWRlci1cIiArIG5hbWUpKSk7XHJcbiAgICAgICAgc2V0QXR0cihidXR0b24sIFwibDEwbi1pZFwiLCBcImhlYWRlci1cIiArIG5hbWUpO1xyXG4gICAgfVxyXG4gICAgYWRkQ2xhc3MoYnV0dG9uLCBidXR0b25DbGFzcyk7XHJcbiAgICBhZGRDbGFzcyhidXR0b24sIFwiLXRlc3QtXCIgKyBuYW1lKTtcclxuICAgIGFkZENsYXNzKGJ1dHRvbiwgXCItdG9nZ2xlLWNsYXNzLVwiICsgbmFtZSk7XHJcbiAgICBpZihvcHRzLmNsYXp6KXtcclxuICAgICAgICBhZGRDbGFzcyhidXR0b24sIG9wdHMuY2xhenopO1xyXG4gICAgfVxyXG4gICAgY29udGFpbmVycy5uYXZpZ2F0aW9uLmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgICBcclxuXHJcbiAgICB2YXIgZWxlbXMsIGk7XHJcbiAgICB2YXIgb25DbGlja0RlbGVnYXRlID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICAvL1Rlc3RzLnJ1bigpO1xyXG4gICAgICAgICAgICBlbGVtcyA9IGNvbnRhaW5lcnMubmF2aWdhdGlvbi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGJ1dHRvbkNsYXNzKTtcclxuICAgICAgICAgICAgaWYob3B0cy50b2dnbGUpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGVscyA9IGdldEVscyhcIi10b2dnbGUtY2xhc3MtXCIgKyBuYW1lKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZXZ0LnRhcmdldC5pc0VxdWFsTm9kZShlbHNbaV0pKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGhhc0NsYXNzKGVsc1tpXSwgXCJhY3RpdmVcIikpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNbaV0uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IGhhc0NsYXNzKGV2dC50YXJnZXQsIFwiYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGVsZW1zW2ldLCBcImFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighb3B0cy50b2dnbGUgfHwgKG9wdHMudG9nZ2xlICYmICFpc0FjdGl2ZSkpe1xyXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MoZXZ0LnRhcmdldCwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHBhc3NFbHMoY29udGFpbmVycy5jb250ZW50LCBnZXRFbCgnd2FyZWhvdXNlJykpO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVycy5jb250ZW50LmFwcGVuZENoaWxkKHZpZXcuY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhjb250YWluZXJzLmNvbnRlbnQsIFwiaGlkZGVuXCIpO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVycy5yb290LmN1cnJlbnRWaWV3ID0gdmlldztcclxuICAgICAgICAgICAgICAgIHZpZXcucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoZXZ0LnRhcmdldCwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICBwYXNzRWxzKGNvbnRhaW5lcnMuY29udGVudCwgZ2V0RWwoJ3dhcmVob3VzZScpKTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lcnMucm9vdC5jdXJyZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhjb250YWluZXJzLmNvbnRlbnQsIFwiaGlkZGVuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkNsaWNrRGVsZWdhdGUodmlldykpO1xyXG4gICAgaWYgKG9wdHMubWFpblBhZ2UpIHtcclxuICAgICAgICBhZGRDbGFzcyhidXR0b24sIFwiYWN0aXZlXCIpO1xyXG4gICAgICAgIGNvbnRhaW5lcnMuY29udGVudC5hcHBlbmRDaGlsZCh2aWV3LmNvbnRlbnQpO1xyXG4gICAgICAgIGNvbnRhaW5lcnMucm9vdC5jdXJyZW50VmlldyA9IHZpZXc7XHJcbiAgICB9XHJcbn07XHJcblxyXG5VdGlscy5hbGVydCA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICB2ZXguZGlhbG9nLmFsZXJ0KG1lc3NhZ2UpO1xyXG59O1xyXG5cclxuVXRpbHMuY29uZmlybSA9IGZ1bmN0aW9uIChtZXNzYWdlLCBvbk9rLCBvbkNhbmNlbCkge1xyXG4gICAgdmV4LmRpYWxvZy5jb25maXJtKHtcclxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxyXG4gICAgICAgIGNhbGxiYWNrOiAodmFsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmKHZhbCl7XHJcbiAgICAgICAgICAgICAgICBpZihvbk9rKSBvbk9rKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZihvbkNhbmNlbCkgb25DYW5jZWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuVXRpbHMucmVtb3ZlQ2hpbGRyZW4gPSBmdW5jdGlvbiAobXlOb2RlKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIGlmICghbXlOb2RlKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgd2hpbGUgKG15Tm9kZS5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgbXlOb2RlLnJlbW92ZUNoaWxkKG15Tm9kZS5maXJzdENoaWxkKTtcclxuICAgIH1cclxufTtcclxuXHJcblV0aWxzLnByb2Nlc3NFcnJvciA9IGZ1bmN0aW9uKGNhbGxiYWNrKXtcclxuICAgIHJldHVybiBmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgIGlmKGVycikge1xyXG4gICAgICAgICAgICBVdGlscy5oYW5kbGVFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goYXJndW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBhcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcblV0aWxzLmhhbmRsZUVycm9yTXNnID0gZnVuY3Rpb24oZXJyKXtcclxuICAgIHZhciBjaGVja0Vycm9yVHlwZSA9IFIuY3VycnkoZnVuY3Rpb24oZXJyLCBuYW1lKXtcclxuICAgICAgICByZXR1cm4gZXJyIGluc3RhbmNlb2YgRXJyb3JzW25hbWVdIHx8IChlcnIubmFtZSAmJiBlcnIubmFtZSA9PT0gbmFtZSlcclxuICAgIH0pO1xyXG4gICAgaWYgKFIua2V5cyhFcnJvcnMpLnNvbWUoY2hlY2tFcnJvclR5cGUoZXJyKSkpIHtcclxuICAgICAgICByZXR1cm4gc3RyRm9ybWF0KGdldEwxMG4oZXJyLm1lc3NhZ2VJZCksIGVyci5wYXJhbWV0ZXJzKTtcclxuICAgIH0gZWxzZSBpZiggdHlwZW9mIGVyciA9PT0gJ29iamVjdCcpe1xyXG4gICAgICAgIHJldHVybiBlcnIubWVzc2FnZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGVycjtcclxuICAgIH1cclxufTtcclxuXHJcblV0aWxzLmhhbmRsZUVycm9yID0gKGVycikgPT4gVXRpbHMuYWxlcnQoVXRpbHMuaGFuZGxlRXJyb3JNc2coZXJyKSk7XHJcblxyXG5VdGlscy5lbmFibGVFbCA9IFIuY3VycnkoZnVuY3Rpb24oZWwsIGNvbmRpdGlvbil7XHJcbiAgICB2YXIga2V5ID0gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHRhcmVhXCIgPyBcInJlYWRvbmx5XCIgOiBcImRpc2FibGVkXCI7XHJcbiAgICBpZihjb25kaXRpb24pe1xyXG4gICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LGtleSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuVXRpbHMuZW5hYmxlID0gZnVuY3Rpb24ocm9vdCwgY2xhc3NOYW1lLCBjb25kaXRpb24pe1xyXG4gICAgbmwyYXJyYXkocm9vdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSkpLm1hcChVdGlscy5lbmFibGVFbChSLl9fLCBjb25kaXRpb24pKTtcclxufTtcclxuXHJcblV0aWxzLmNoYXJPcmRBT2JqZWN0ID0gQ29tbW9uVXRpbHMuY2hhck9yZEFGYWN0b3J5KGZ1bmN0aW9uKGEpe1xyXG4gICAgcmV0dXJuIGEuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKTtcclxufSk7XHJcblxyXG5VdGlscy5yZWJ1aWxkU2VsZWN0b3IgPSBmdW5jdGlvbihzZWxlY3RvciwgbmFtZXMpe1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBjbGVhckVsKHNlbGVjdG9yKTtcclxuICAgIG5hbWVzLmZvckVhY2goZnVuY3Rpb24gKG5hbWVJbmZvKSB7XHJcbiAgICAgICAgdmFyIG9wdGlvbiA9IG1ha2VFbChcIm9wdGlvblwiKTtcclxuICAgICAgICBvcHRpb24uYXBwZW5kQ2hpbGQobWFrZVRleHQobmFtZUluZm8uZGlzcGxheU5hbWUpKTtcclxuICAgICAgICBvcHRpb24udmFsdWUgPSBuYW1lSW5mby52YWx1ZTtcclxuICAgICAgICBzZWxlY3Rvci5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5VdGlscy5yZWJ1aWxkU2VsZWN0b3JBcnIgPSBmdW5jdGlvbihzZWxlY3RvciwgbmFtZXMpe1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBjbGVhckVsKHNlbGVjdG9yKTtcclxuICAgIG5hbWVzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICB2YXIgb3B0aW9uID0gbWFrZUVsKFwib3B0aW9uXCIpO1xyXG4gICAgICAgIG9wdGlvbi5hcHBlbmRDaGlsZChtYWtlVGV4dChuYW1lKSk7XHJcbiAgICAgICAgc2VsZWN0b3IuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuU3RyaW5nLnByb3RvdHlwZS5lbmRzV2l0aCA9IGZ1bmN0aW9uIChzdWZmaXgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgcmV0dXJuIHRoaXMuaW5kZXhPZihzdWZmaXgsIHRoaXMubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aCkgIT09IC0xO1xyXG59O1xyXG5cclxudmFyIHN0ckZvcm1hdCA9IFIuY3VycnkoQ29tbW9uVXRpbHMuc3RyRm9ybWF0KTtcclxuXHJcbmZ1bmN0aW9uIGdldEwxMG4oa2V5KXtcclxuICAgIHJldHVybiBMMTBuLmdldFZhbHVlKGtleSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBjb25zdEwxMG4oa2V5KXtcclxuICAgIHJldHVybiBMMTBuLmdldFZhbHVlKCdjb25zdGFudC0nICsga2V5KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNFbXB0eSAob2JqKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHJldHVybiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKS5sZW5ndGggPT09IDApO1xyXG59O1xyXG5cclxudmFyIGFkZENsYXNzID0gUi5jdXJyeShmdW5jdGlvbihvLCBjKXtcclxuICAgIHZhciByZSA9IG5ldyBSZWdFeHAoXCIoXnxcXFxccylcIiArIGMgKyBcIihcXFxcc3wkKVwiLCBcImdcIilcclxuICAgIGlmIChyZS50ZXN0KG8uY2xhc3NOYW1lKSkgcmV0dXJuO1xyXG4gICAgby5jbGFzc05hbWUgPSAoby5jbGFzc05hbWUgKyBcIiBcIiArIGMpLnJlcGxhY2UoL1xccysvZywgXCIgXCIpLnJlcGxhY2UoLyheIHwgJCkvZywgXCJcIik7XHJcbiAgICByZXR1cm4gbztcclxufSk7XHJcblxyXG52YXIgYWRkQ2xhc3NlcyA9IFIuY3VycnkoZnVuY3Rpb24obywgYyl7XHJcbiAgICBSLmFwKFthZGRDbGFzcyhvKV0sIGMpO1xyXG4gICAgcmV0dXJuIG87XHJcbn0pO1xyXG5cclxudmFyIHJBZGRDbGFzcyA9IFIuY3VycnkoZnVuY3Rpb24oYywgbyl7XHJcbiAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIihefFxcXFxzKVwiICsgYyArIFwiKFxcXFxzfCQpXCIsIFwiZ1wiKVxyXG4gIGlmIChyZS50ZXN0KG8uY2xhc3NOYW1lKSkgcmV0dXJuO1xyXG4gIG8uY2xhc3NOYW1lID0gKG8uY2xhc3NOYW1lICsgXCIgXCIgKyBjKS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS5yZXBsYWNlKC8oXiB8ICQpL2csIFwiXCIpO1xyXG4gIHJldHVybiBvO1xyXG59KTtcclxuXHJcbnZhciB0b2dnbGVDbGFzcyA9IFIuY3VycnkoZnVuY3Rpb24obywgYyl7XHJcbiAgICBpZihoYXNDbGFzcyhvLCBjKSl7XHJcbiAgICAgICAgcmVtb3ZlQ2xhc3MobywgYyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFkZENsYXNzKG8sIGMpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGhhc0NsYXNzKG8sIGMpe1xyXG4gICAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIihefFxcXFxzKVwiICsgYyArIFwiKFxcXFxzfCQpXCIsIFwiZ1wiKVxyXG4gICAgcmV0dXJuIChyZS50ZXN0KG8uY2xhc3NOYW1lKSk7XHJcbn07XHJcbiBcclxudmFyIHJlbW92ZUNsYXNzID0gUi5jdXJyeShmdW5jdGlvbihvLCBjKXtcclxuICAgIHZhciByZSA9IG5ldyBSZWdFeHAoXCIoXnxcXFxccylcIiArIGMgKyBcIihcXFxcc3wkKVwiLCBcImdcIilcclxuICAgIG8uY2xhc3NOYW1lID0gby5jbGFzc05hbWUucmVwbGFjZShyZSwgXCIkMVwiKS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS5yZXBsYWNlKC8oXiB8ICQpL2csIFwiXCIpXHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gc2V0Q2xhc3NCeUNvbmRpdGlvbihvLGMsY29uZGl0aW9uKXtcclxuICAgIGlmKGNvbmRpdGlvbil7XHJcbiAgICAgICAgYWRkQ2xhc3MobyxjKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVtb3ZlQ2xhc3MobyxjKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0RWwoaWQpe1xyXG4gIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBxdWVyeUVsKHNlbCl7XHJcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWwpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcXVlcnlFbHMoc2VsKXtcclxuICAgIHJldHVybiBubDJhcnJheShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcXVlcnlFbEVscyhlbCwgc2VsKXtcclxuICAgIHJldHVybiBubDJhcnJheShlbC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0RWxzKGNsYXp6KXtcclxuICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGF6eik7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBtYWtlRWwoZWxUYWcpe1xyXG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsVGFnKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIG1ha2VUZXh0KHRleHQpe1xyXG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcclxufTtcclxuXHJcbnZhciBhZGRFbCA9IFIuY3VycnkoZnVuY3Rpb24ocGFyZW50LCBjaGlsZCl7XHJcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xyXG4gICAgcmV0dXJuIHBhcmVudDtcclxufSk7XHJcbnZhciBhZGRFbHMgPSBSLmN1cnJ5KGZ1bmN0aW9uKHBhcmVudCwgY2hpbGRyZW4pe1xyXG4gICAgUi5hcChbYWRkRWwocGFyZW50KV0sIGNoaWxkcmVuKTtcclxuICAgIHJldHVybiBwYXJlbnQ7XHJcbn0pO1xyXG5cclxudmFyIG1ha2VPcHQgPSBmdW5jdGlvbihsYWJlbCl7XHJcbiAgICB2YXIgb3B0aW9uID0gbWFrZUVsKFwib3B0aW9uXCIpO1xyXG4gICAgYWRkRWwob3B0aW9uLCAobWFrZVRleHQobGFiZWwpKSk7XHJcbiAgICByZXR1cm4gb3B0aW9uO1xyXG59O1xyXG5cclxudmFyIHJBZGRFbCA9IFIuY3VycnkoZnVuY3Rpb24oY2hpbGQsIHBhcmVudCl7XHJcbiAgcGFyZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICByZXR1cm4gcGFyZW50O1xyXG59KTtcclxuXHJcbnZhciBzZXRBdHRyID0gUi5jdXJyeShmdW5jdGlvbihlbCwgbmFtZSwgdmFsdWUpe1xyXG4gIGVsLnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XHJcbiAgcmV0dXJuIGVsO1xyXG59KTtcclxuXHJcbnZhciBzZXRTdHlsZSA9IFIuY3VycnkoZnVuY3Rpb24oZWwsIG5hbWUsIHZhbHVlKXtcclxuICAgIGVsLnN0eWxlW25hbWVdID0gdmFsdWU7XHJcbiAgICByZXR1cm4gZWw7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZGVsQXR0cihlbCwgbmFtZSl7XHJcbiAgICBlbC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XHJcbiAgICByZXR1cm4gZWw7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBnZXRBdHRyKGVsLCBuYW1lKXtcclxuICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUobmFtZSk7XHJcbn07XHJcblxyXG52YXIgc2V0UHJvcCA9IFIuY3VycnkoZnVuY3Rpb24oZWwsIGtleSwgdmFsdWUpe1xyXG4gIGVsW2tleV0gPSB2YWx1ZTtcclxuICByZXR1cm4gZWw7XHJcbn0pO1xyXG5cclxudmFyIHNldFByb3BzID0gUi5jdXJyeShmdW5jdGlvbihlbCwgbWFwKXtcclxuICBmb3IodmFyIGtleSBpbiBtYXApe1xyXG4gICAgc2V0UHJvcChlbCwga2V5LCBtYXBba2V5XSk7XHJcbiAgfVxyXG4gIHJldHVybiBlbDtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBjbGVhckVsKGVsKXtcclxuICBVdGlscy5yZW1vdmVDaGlsZHJlbihlbCk7XHJcbiAgcmV0dXJuIGVsO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcGFzc0VscyhzcmMsIGRzdCl7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNyYy5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGFkZEVsKGRzdCwgc3JjLmNoaWxkcmVuW2ldKTtcclxuICAgIH1cclxufTtcclxuXHJcbnZhciBsaXN0ZW4gPSBSLmN1cnJ5KGZ1bmN0aW9uKGVsLCBldmVudCwgbGlzdGVuZXIpe1xyXG4gIGVsLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGxpc3RlbmVyKTtcclxuICByZXR1cm4gZWw7XHJcbn0pO1xyXG5cclxudmFyIGxpc3Rlbk9uRW50ZXIgPSBSLmN1cnJ5KGZ1bmN0aW9uKGVsLCBjYWxsYmFjayl7XHJcbiAgICBsaXN0ZW4oZWwsICdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxudmFyIGZpbGxTZWxlY3RvciA9IFIuY3VycnkoZnVuY3Rpb24oc2VsLCBkYXRhKXtcclxuICAgIHJldHVybiBhZGRFbHMoc2VsLCBkYXRhLm1hcChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHZhciBvcHQgPSBtYWtlRWwoXCJvcHRpb25cIik7XHJcbiAgICAgICAgYWRkRWwob3B0LCBtYWtlVGV4dChpdGVtLm5hbWUpKTtcclxuICAgICAgICBpZihpdGVtLnZhbHVlKXtvcHQudmFsdWUgPSBpdGVtLnZhbHVlO31cclxuICAgICAgICBpZihpdGVtLnNlbGVjdGVkKXtvcHQuc2VsZWN0ZWQgPSB0cnVlO31cclxuICAgICAgICBpZihpdGVtLmNsYXNzTmFtZSl7YWRkQ2xhc3Mob3B0LCBpdGVtLmNsYXNzTmFtZSk7fVxyXG4gICAgICAgIHJldHVybiBvcHQ7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gbmwyYXJyYXkobm9kZUxpc3Qpe1xyXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG5vZGVMaXN0KTtcclxufTtcclxuXHJcbnZhciByZW1hcFByb3BzID0gUi5jdXJyeShmdW5jdGlvbihvdXRLZXlzLCBwaWNrS2V5cywgb2JqKXtcclxuICAgIHJldHVybiBSLmNvbXBvc2UoUi56aXBPYmoob3V0S2V5cyksIFIudmFsdWVzLCBSLnBpY2socGlja0tleXMpKShvYmopO1xyXG59KTtcclxuXHJcbnZhciByZW1hcFByb3BzNFNlbGVjdDIgPSByZW1hcFByb3BzKFsnaWQnLCd0ZXh0J10sIFsndmFsdWUnLCAnZGlzcGxheU5hbWUnXSk7XHJcbnZhciByZW1hcFByb3BzNFNlbGVjdCA9IHJlbWFwUHJvcHMoWyd2YWx1ZScsJ25hbWUnXSwgWyd2YWx1ZScsICdkaXNwbGF5TmFtZSddKTtcclxuXHJcbnZhciBnZXRTZWxlY3QyRGF0YUNvbW1vbiA9IFIuY3VycnkoZnVuY3Rpb24ocHJlcGFyYXRvciwgb2JqKXsgXHJcbiAgICByZXR1cm4gUi5jb21wb3NlKFIuemlwT2JqKFsnZGF0YSddKSwgUi5hcHBlbmQoUi5fXywgW10pLCBSLm1hcChwcmVwYXJhdG9yKSkob2JqKTtcclxufSk7XHJcblxyXG52YXIgZ2V0U2VsZWN0MkRhdGEgPSBnZXRTZWxlY3QyRGF0YUNvbW1vbihyZW1hcFByb3BzNFNlbGVjdDIpO1xyXG5cclxudmFyIG1ha2VTZWxlY3QyT3B0ID0gUi5jb21wb3NlKFIuemlwT2JqKFsnaWQnLCAndGV4dCddKSwgUi5yZXBlYXQoUi5fXywgMikpO1xyXG52YXIgYXJyMlNlbGVjdDIgPSBSLmNvbXBvc2UoUi5hc3NvYygnZGF0YScsIFIuX18sIHt9KSwgUi5tYXAobWFrZVNlbGVjdDJPcHQpKTtcclxudmFyIGFycjJTZWxlY3QgPSBSLm1hcChSLmNvbXBvc2UoUi56aXBPYmooWyd2YWx1ZScsJ25hbWUnXSksIFIucmVwZWF0KFIuX18sIDIpKSk7XHJcbnZhciBjb25zdEFycjJTZWxlY3QgPSBSLm1hcChSLmNvbXBvc2UoUi56aXBPYmooWyd2YWx1ZScsJ25hbWUnXSksIChuYW1lKSA9PiBbbmFtZSwgY29uc3RMMTBuKG5hbWUpXSkpO1xyXG5cclxudmFyIGdldFNlbGVjdGVkUmFkaW8gPSBmdW5jdGlvbihxdWVyeSl7XHJcbiAgICB2YXIgZWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChxdWVyeSk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVscy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmKGVsc1tpXS5jaGVja2VkID09PSB0cnVlKXtcclxuICAgICAgICAgICAgcmV0dXJuIGVsc1tpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbnZhciBkZWJ1Z0ludGVyY2VwdG9yID0gZnVuY3Rpb24oY2FsbGJhY2spe1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoYXJndW1lbnRzWzBdKSk7XHJcbiAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIGZyb20gZGF0ZSBmb3JtYXQgdXRpbHNcclxuLy9Gb3IgY29udmVuaWVuY2UuLi5cclxuRGF0ZS5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24gKG1hc2ssIHV0Yykge1xyXG4gICAgcmV0dXJuIGRhdGVGb3JtYXQodGhpcywgbWFzaywgdXRjKTtcclxufTtcclxuXHJcbiIsIi8qQ29weXJpZ2h0IDIwMTcgVGltb2ZleSBSZWNoa2Fsb3YgPG50c2RrQHlhbmRleC5ydT5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG5odHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4gKi9cclxuXHJcbi8qZ2xvYmFsXHJcblV0aWxzLCBPdmVydmlldywgUHJvZmlsZXMsIFN0b3JpZXMsIEFkYXB0YXRpb25zLCBCcmllZmluZ3MsIFRpbWVsaW5lLCBTb2NpYWxOZXR3b3JrLCBGaWxlVXRpbHNcclxuICovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbihmdW5jdGlvbihleHBvcnRzKXtcclxuXHJcbiAgICB2YXIgc3RhdGUgPSB7fTtcclxuICAgIHN0YXRlLnZpZXdzID0ge307XHJcbiAgICBcclxuICAgIHZhciBidG5PcHRzID0ge1xyXG4gICAgICAgIHRvb2x0aXAgOiB0cnVlLFxyXG4gICAgICAgIGNsYXNzTmFtZSA6ICdtYWluTmF2QnV0dG9uJ1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB2YXIgaW5pdFBhZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIEwxMG4ubG9jYWxpemVTdGF0aWMoKTtcclxuICAgICAgICBMMTBuLm9uTDEwbkNoYW5nZSgoKSA9PiBzdGF0ZS5jdXJyZW50Vmlldy5yZWZyZXNoKCkpO1xyXG4gICAgICAgIFVJLmluaXRTZWxlY3RvckZpbHRlcnMoKTtcclxuICAgICAgICBVSS5pbml0UGFuZWxUb2dnbGVycygpO1xyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURpYWxvZ3MoKXtcclxuICAgICAgICAgICAgdmV4LmRpYWxvZy5idXR0b25zLllFUy50ZXh0ID0gZ2V0TDEwbignY29tbW9uLW9rJyk7XHJcbiAgICAgICAgICAgIHZleC5kaWFsb2cuYnV0dG9ucy5OTy50ZXh0ID0gZ2V0TDEwbignY29tbW9uLWNhbmNlbCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB1cGRhdGVEaWFsb2dzKCk7XHJcbiAgICAgICAgTDEwbi5vbkwxMG5DaGFuZ2UodXBkYXRlRGlhbG9ncyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHZhciBjdXJUaGVtZSA9IENvbnN0YW50cy50aGVtZUxpc3RbMV07XHJcbiAgICBcclxuICAgIHZhciBpbml0VGhlbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZihEQk1TLnNldFRoZW1lKXtcclxuICAgICAgICAgICAgREJNUy5nZXRUaGVtZShmdW5jdGlvbihlcnIsIHRoZW1lKXtcclxuICAgICAgICAgICAgICAgIGlmKGVycikge2NvbnNvbGUubG9nKGVycik7fVxyXG4gICAgICAgICAgICAgICAgaWYodGhlbWUgIT09ICcnKXtcclxuICAgICAgICAgICAgICAgICAgICBjdXJUaGVtZSA9IHRoZW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MocXVlcnlFbCgnYm9keScpLCBjdXJUaGVtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKHF1ZXJ5RWwoJ2JvZHknKSwgY3VyVGhlbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBcclxuICAgIHZhciBuZXh0VGhlbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZW1vdmVDbGFzcyhxdWVyeUVsKCdib2R5JyksIGN1clRoZW1lKTtcclxuICAgICAgICBjdXJUaGVtZSA9IENvbnN0YW50cy50aGVtZUxpc3RbKFIuaW5kZXhPZihjdXJUaGVtZSwgQ29uc3RhbnRzLnRoZW1lTGlzdCkrMSklQ29uc3RhbnRzLnRoZW1lTGlzdC5sZW5ndGhdO1xyXG4gICAgICAgIGFkZENsYXNzKHF1ZXJ5RWwoJ2JvZHknKSwgY3VyVGhlbWUpO1xyXG4gICAgICAgIGlmKERCTVMuc2V0VGhlbWUpe1xyXG4gICAgICAgICAgICBEQk1TLnNldFRoZW1lKGN1clRoZW1lLCBmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgICAgICAgICAgaWYoZXJyKSB7Y29uc29sZS5sb2coZXJyKTsgcmV0dXJuO31cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIHByb3RvRXhwYW5kZXIgPSBmdW5jdGlvbihhcnIpe1xyXG4gICAgICAgIGZ1bmN0aW9uIHByb3RvQ2Fycmllcigpe307XHJcbiAgICAgICAgYXJyLmZvckVhY2goIG5hbWUgPT4gcHJvdG9DYXJyaWVyLnByb3RvdHlwZVtuYW1lXSA9ICgoKSA9PiAxKSk7XHJcbiAgICAgICAgcmV0dXJuIHByb3RvQ2FycmllcjtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHZhciBwbGF5ZXJBcnIgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgJ2dldFNob3AnICAgICAgICAsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVDYXRlZ29yeVwiICxcclxuICAgICAgICAgICAgICAgICAgICBcInJlbmFtZUNhdGVnb3J5XCIgLFxyXG4gICAgICAgICAgICAgICAgICAgIFwicmVtb3ZlQ2F0ZWdvcnlcIiAsXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXCJnZXRMb2NhbEFzc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVMb2NhbEFzc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJyZW5hbWVMb2NhbEFzc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJyZW1vdmVMb2NhbEFzc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVMb2NhbEFzc2V0RmllbGRcIixcclxuICAgICAgICAgICAgICAgICAgICBcInNldEFzc2V0Q29zdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiYWRkR2xvYmFsQXNzZXRUb0NhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJhZGRMb2NhbEFzc2V0VG9DYXRlZ29yeVwiICxcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBcInJlbW92ZUdsb2JhbEFzc2V0RnJvbUNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJyZW1vdmVMb2NhbEFzc2V0RnJvbUNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJnZXRTaG9wTmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiZ2V0QXNzZXRcIixcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBcImdldFNob3BJbmRleFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiZ2V0R2xvYmFsQXNzZXREaXNwbGF5TmFtZXNcIixcclxuICAgICAgICAgICAgICAgICAgICBcImJ1eUFzc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJnZXRUaGVtZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2V0VGhlbWVcIixcclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG4gICAgXHJcbiAgICBleHBvcnRzLm9uUGxheWVyUGFnZUxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5pdFBhZ2UoKTtcclxuICAgICAgICB2YXIgUmVtb3RlREJNUyA9IG1ha2VSZW1vdGVEQk1TKHByb3RvRXhwYW5kZXIocGxheWVyQXJyKSk7XHJcbiAgICAgICAgd2luZG93LkRCTVMgPSBuZXcgUmVtb3RlREJNUygpO1xyXG4gICAgICAgIGluaXRUaGVtZSgpO1xyXG4gICAgICAgIHN0YXRlSW5pdCgpO1xyXG4gICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJzaG9wLW1hbmFnZW1lbnRcIiwgUGxheWVyU2hvcE1hbmFnZW1lbnQsIHttYWluUGFnZTp0cnVlfSk7XHJcbiAgICAgICAgVXRpbHMuYWRkVmlldyhzdGF0ZS5jb250YWluZXJzLCBcInNob3Atd2luZG93XCIsIFNob3BXaW5kb3cpO1xyXG4gICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJzaG9wLWFib3V0XCIsIFNob3BBYm91dCk7XHJcbiAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgYWRkQ2xhc3MobWFrZUVsKFwiZGl2XCIpLCBcIm5hdi1zZXBhcmF0b3JcIikpO1xyXG4vLyAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUwxMG5CdXR0b24oKSk7XHJcbiAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcInRoZW1lQnV0dG9uXCIsIFwidGhlbWVcIiwgKCkgPT4gbmV4dFRoZW1lKCksIGJ0bk9wdHMpKTtcclxuICAgICAgICBhZGRFbChzdGF0ZS5uYXZpZ2F0aW9uLCBtYWtlQnV0dG9uKFwibG9nb3V0QnV0dG9uXCIsIFwibG9nb3V0XCIsIHBvc3RMb2dvdXQsIGJ0bk9wdHMpKTtcclxuICAgICAgICBhZGRFbChzdGF0ZS5uYXZpZ2F0aW9uLCBtYWtlQnV0dG9uKFwicmVmcmVzaEJ1dHRvblwiLCBcInJlZnJlc2hcIiwgKCkgPT4gc3RhdGUuY3VycmVudFZpZXcucmVmcmVzaCgpLCBidG5PcHRzKSk7XHJcbiAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcImZ1bGxTY3JlZW5CdXR0b25cIiwgXCJmdWxsU2NyZWVuXCIsIHRvZ2dsZVRvb2xiYXJCdXR0b25zLCBidG5PcHRzKSk7XHJcbiAgICAgICAgc3RhdGUuY3VycmVudFZpZXcucmVmcmVzaCgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIHRvZ2dsZVRvb2xiYXJCdXR0b25zID0gKCkgPT4ge1xyXG4gICAgICAgIHF1ZXJ5RWxzKCcjbmF2aWdhdGlvbiA+IGJ1dHRvbicpLmZpbHRlciggYnV0dG9uID0+ICFoYXNDbGFzcyhidXR0b24sICdyZWZyZXNoQnV0dG9uJykgJiYgIWhhc0NsYXNzKGJ1dHRvbiwgJ2Z1bGxTY3JlZW5CdXR0b24nKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAodG9nZ2xlQ2xhc3MoUi5fXywgJ2hpZGRlbicpKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMub25JbmRleFBhZ2VMb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluaXRQYWdlKCk7XHJcbiAgICAgICAgdmFyIFJlbW90ZURCTVMgPSBtYWtlUmVtb3RlREJNUyhwcm90b0V4cGFuZGVyKFsnZ2V0UGxheWVyc09wdGlvbnMnLCdnZXRSb2xlR3JpZEluZm8nXSkpO1xyXG4gICAgICAgIHdpbmRvdy5EQk1TID0gbmV3IFJlbW90ZURCTVMoKTtcclxuICAgICAgICBpbml0VGhlbWUoKTtcclxuICAgICAgICBzdGF0ZUluaXQoKTtcclxuICAgICAgICBhZGRFbChzdGF0ZS5uYXZpZ2F0aW9uLCBhZGRDbGFzcyhtYWtlRWwoXCJkaXZcIiksIFwibmF2LXNlcGFyYXRvclwiKSk7XHJcbiAgICAgICAgVXRpbHMuYWRkVmlldyhzdGF0ZS5jb250YWluZXJzLCBcImVudGVyXCIsIEVudGVyLCB7bWFpblBhZ2U6dHJ1ZX0pO1xyXG4vLyAgICAgICAgICAgIGFkZEVsKHN0YXRlLm5hdmlnYXRpb24sIG1ha2VMMTBuQnV0dG9uKCkpO1xyXG4gICAgICAgIHN0YXRlLmN1cnJlbnRWaWV3LnJlZnJlc2goKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGV4cG9ydHMub25NYXN0ZXJQYWdlTG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbml0UGFnZSgpO1xyXG4gICAgICAgIHZhciBMb2NhbERCTVMgPSBtYWtlTG9jYWxEQk1TKHRydWUpO1xyXG4gICAgICAgIGlmKE1PREUgPT09IFwiU3RhbmRhbG9uZVwiKXtcclxuICAgICAgICAgICAgd2luZG93LkRCTVMgPSBuZXcgTG9jYWxEQk1TKCk7XHJcbiAgICAgICAgICAgIERCTVMuc2V0RGF0YWJhc2UoQmFzZUV4YW1wbGUuZGF0YSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgICAgICAgIGlmKGVycikge1V0aWxzLmhhbmRsZUVycm9yKGVycik7IHJldHVybjt9XHJcbiAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeUNoZWNrKG9uRGF0YWJhc2VMb2FkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIGlmKE1PREUgPT09IFwiTklNU19TZXJ2ZXJcIikge1xyXG4gICAgICAgICAgICB2YXIgUmVtb3RlREJNUyA9IG1ha2VSZW1vdGVEQk1TKExvY2FsREJNUyk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5EQk1TID0gbmV3IFJlbW90ZURCTVMoKTtcclxuICAgICAgICAgICAgY29uc2lzdGVuY3lDaGVjayhvbkRhdGFiYXNlTG9hZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIGNvbnNpc3RlbmN5Q2hlY2sgPSBmdW5jdGlvbihjYWxsYmFjayl7XHJcbiAgICAgICAgREJNUy5nZXRDb25zaXN0ZW5jeUNoZWNrUmVzdWx0KGZ1bmN0aW9uKGVyciwgY29uc2lzdGVuY3lFcnJvcnMpe1xyXG4gICAgICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgICAgICBjb25zaXN0ZW5jeUVycm9ycy5mb3JFYWNoKENvbW1vblV0aWxzLmNvbnNvbGVMb2cpO1xyXG4gICAgICAgICAgICBpZihjb25zaXN0ZW5jeUVycm9ycy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFsZXJ0KGdldEwxMG4oJ292ZXJ2aWV3LWNvbnNpc3RlbmN5LXByb2JsZW0tZGV0ZWN0ZWQnKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ29uc2lzdGVuY3kgY2hlY2sgZGlkblxcJ3QgZmluZCBlcnJvcnMnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIHN0YXRlSW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgc3RhdGUubmF2aWdhdGlvbiA9IGdldEVsKFwibmF2aWdhdGlvblwiKTtcclxuICAgICAgICBzdGF0ZS5jb250YWluZXJzID0ge1xyXG4gICAgICAgICAgICAgICAgcm9vdDogc3RhdGUsXHJcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBzdGF0ZS5uYXZpZ2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogZ2V0RWwoXCJjb250ZW50QXJlYVwiKVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB2YXIgb25EYXRhYmFzZUxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5pdFRoZW1lKCk7XHJcbiAgICAgICAgUGVybWlzc2lvbkluZm9ybWVyLnJlZnJlc2goZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgICAgaWYoZXJyKSB7VXRpbHMuaGFuZGxlRXJyb3IoZXJyKTsgcmV0dXJuO31cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFBlcm1pc3Npb25JbmZvcm1lci5pc0FkbWluKGZ1bmN0aW9uKGVyciwgaXNBZG1pbil7XHJcbiAgICAgICAgICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uO1xyXG4gICAgICAgICAgICAgICAgc3RhdGVJbml0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgVXRpbHMuYWRkVmlldyhzdGF0ZS5jb250YWluZXJzLCBcInNob3AtbWFuYWdlbWVudFwiLCBNYXN0ZXJTaG9wTWFuYWdlbWVudCwge21haW5QYWdlOnRydWV9KTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJzaG9wczJcIiwgU2hvcHMyKTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJhc3NldHNcIiwgQXNzZXRzKTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJhcGlDaGVja1wiLCBBcGlDaGVjayk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGFkZEVsKHN0YXRlLm5hdmlnYXRpb24sIGFkZENsYXNzKG1ha2VFbChcImRpdlwiKSwgXCJuYXYtc2VwYXJhdG9yXCIpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoaXNBZG1pbil7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IG1ha2VCdXR0b24oXCJkYXRhTG9hZEJ1dHRvblwiLCBcIm9wZW4tZGF0YWJhc2VcIiwgbnVsbCwgYnRuT3B0cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIEZpbGVVdGlscy5yZWFkU2luZ2xlRmlsZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IG1ha2VFbChcImlucHV0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnR5cGUgPSBcImZpbGVcIjtcclxuICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyhpbnB1dCwgJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldEF0dHIoaW5wdXQsICd0YWJpbmRleCcsIC0xKTtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b24uYXBwZW5kQ2hpbGQoaW5wdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jbGljaygpO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCBuYXZpZ2F0aW9uIHRvIFwiI1wiXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgYnV0dG9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcInRoZW1lQnV0dG9uXCIsIFwidGhlbWVcIiwgKCkgPT4gbmV4dFRoZW1lKCksIGJ0bk9wdHMpKTtcclxuICAgICAgICAgICAgICAgIGFkZEVsKHN0YXRlLm5hdmlnYXRpb24sIG1ha2VCdXR0b24oXCJkYXRhU2F2ZUJ1dHRvblwiLCBcInNhdmUtZGF0YWJhc2VcIiwgRmlsZVV0aWxzLnNhdmVGaWxlLCBidG5PcHRzKSk7XHJcbiAgICAgICAgICAgICAgICBpZihNT0RFID09PSBcIlN0YW5kYWxvbmVcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcIm5ld0Jhc2VCdXR0b25cIiwgXCJjcmVhdGUtZGF0YWJhc2VcIiwgRmlsZVV0aWxzLm1ha2VOZXdCYXNlLCBidG5PcHRzKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbi8vICAgICAgICAgICAgICAgIGFkZEVsKHN0YXRlLm5hdmlnYXRpb24sIG1ha2VCdXR0b24oXCJtYWluSGVscEJ1dHRvblwiLCBcImRvY3NcIiwgRmlsZVV0aWxzLm9wZW5IZWxwLCBidG5PcHRzKSk7XHJcbiAgICAgICAgICAgICAgICBcclxuLy8gICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUwxMG5CdXR0b24oKSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFkZFZpZXcoc3RhdGUuY29udGFpbmVycywgXCJsb2dWaWV3ZXJcIiwgTG9nVmlld2VyMiwge2NsYXp6OlwibG9nVmlld2VyQnV0dG9uXCIsIHRvb2x0aXA6dHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcInRlc3RCdXR0b25cIiwgXCJ0ZXN0XCIsIHJ1blRlc3RzLCBidG5PcHRzKSk7XHJcbiAgICAgICAgICAgICAgICBpZihNT0RFID09PSBcIk5JTVNfU2VydmVyXCIpe1xyXG4vLyAgICAgICAgICAgICAgICAgICAgVXRpbHMuYWRkVmlldyhzdGF0ZS5jb250YWluZXJzLCBcImFkbWluc1wiLCBBY2Nlc3NNYW5hZ2VyLCB7Y2xheno6XCJhY2Nlc3NNYW5hZ2VyQnV0dG9uXCIsIHRvb2x0aXA6dHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZEVsKHN0YXRlLm5hdmlnYXRpb24sIG1ha2VCdXR0b24oXCJsb2dvdXRCdXR0b25cIiwgXCJsb2dvdXRcIiwgcG9zdExvZ291dCwgYnRuT3B0cykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYWRkRWwoc3RhdGUubmF2aWdhdGlvbiwgbWFrZUJ1dHRvbihcInJlZnJlc2hCdXR0b25cIiwgXCJyZWZyZXNoXCIsICgpID0+IHN0YXRlLmN1cnJlbnRWaWV3LnJlZnJlc2goKSwgYnRuT3B0cykpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBGaWxlVXRpbHMuaW5pdChmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGVycikge1V0aWxzLmhhbmRsZUVycm9yKGVycik7IHJldHVybjt9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc2lzdGVuY3lDaGVjayhzdGF0ZS5jdXJyZW50Vmlldy5yZWZyZXNoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBzdGF0ZS5jdXJyZW50Vmlldy5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICBpZihNT0RFID09PSBcIlN0YW5kYWxvbmVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZEJlZm9yZVVubG9hZExpc3RlbmVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIG1ha2VMMTBuQnV0dG9uID0gZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbDEwbkJ0biA9IG1ha2VCdXR0b24oXCJ0b2dnbGVMMTBuQnV0dG9uXCIsIFwibDEwblwiLCBMMTBuLnRvZ2dsZUwxMG4sIGJ0bk9wdHMpO1xyXG4gICAgICAgIHZhciBzZXRJY29uID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgbDEwbkJ0bi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBzdHJGb3JtYXQoJ3VybChcIi4vaW1hZ2VzL3swfS5zdmdcIiknLCBbZ2V0TDEwbignaGVhZGVyLWRpY3Rpb25hcnktaWNvbicpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEwxMG4ub25MMTBuQ2hhbmdlKHNldEljb24pO1xyXG4gICAgICAgIHNldEljb24oKTtcclxuICAgICAgICByZXR1cm4gbDEwbkJ0bjtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHZhciBydW5UZXN0cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAvLyAgICB3aW5kb3cuUnVuVGVzdHMoKTtcclxuICAgICAgICBjb25zaXN0ZW5jeUNoZWNrKGZ1bmN0aW9uKGVyciwgY2hlY2tSZXMpe1xyXG4gICAgICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgICAgICBpZihjaGVja1JlcyA9PT0gdW5kZWZpbmVkIHx8IGNoZWNrUmVzLmxlbmd0aCA9PT0gMCl7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hbGVydChnZXRMMTBuKCdvdmVydmlldy1jb25zaXN0ZW5jeS1pcy1vaycpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFsZXJ0KGdldEwxMG4oJ292ZXJ2aWV3LWNvbnNpc3RlbmN5LXByb2JsZW0tZGV0ZWN0ZWQnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHZhciBwb3N0TG9nb3V0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9nb3V0Rm9ybSBidXR0b24nKS5jbGljaygpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIG1ha2VCdXR0b24gPSBmdW5jdGlvbihjbGF6eiwgbmFtZSwgY2FsbGJhY2ssIG9wdHMpe1xyXG4gICAgICAgIHZhciBidXR0b24gPSBtYWtlRWwoXCJidXR0b25cIik7XHJcbiAgICAgICAgYWRkQ2xhc3MoYnV0dG9uLCBjbGF6eik7XHJcbiAgICAgICAgaWYob3B0cy50b29sdGlwKXtcclxuICAgICAgICAgICAgdmFyIGRlbGVnYXRlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICQoYnV0dG9uKS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgTDEwbi5nZXRWYWx1ZShcImhlYWRlci1cIiArIG5hbWUpKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgTDEwbi5vbkwxMG5DaGFuZ2UoZGVsZWdhdGUpO1xyXG4gICAgICAgICAgICAkKGJ1dHRvbikudG9vbHRpcCh7XHJcbiAgICAgICAgICAgICAgICB0aXRsZSA6IEwxMG4uZ2V0VmFsdWUoXCJoZWFkZXItXCIgKyBuYW1lKSxcclxuICAgICAgICAgICAgICAgIHBsYWNlbWVudCA6IFwiYm90dG9tXCJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFkZENsYXNzKGJ1dHRvbiwgXCJhY3Rpb24tYnV0dG9uXCIpO1xyXG4gICAgICAgIGlmKG9wdHMuY2xhc3NOYW1lKXtcclxuICAgICAgICAgICAgYWRkQ2xhc3MoYnV0dG9uLCBvcHRzLmNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgbGlzdGVuKGJ1dHRvbiwgJ2NsaWNrJywgY2FsbGJhY2spO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYnV0dG9uO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdmFyIGFkZEJlZm9yZVVubG9hZExpc3RlbmVyID0gZnVuY3Rpb24oKXtcclxuICAgICAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gZ2V0TDEwbihcInV0aWxzLWNsb3NlLXBhZ2Utd2FybmluZ1wiKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBldnQgPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgZXZ0ID0gd2luZG93LmV2ZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldnQpIHtcclxuICAgICAgICAgICAgICAgIGV2dC5yZXR1cm5WYWx1ZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG5cclxufSkodGhpc1snUGFnZU1hbmFnZXInXT17fSk7IiwiLypDb3B5cmlnaHQgMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuICovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbihmdW5jdGlvbihleHBvcnRzLCBtb2RlKXtcclxuXHJcbiAgICB2YXIgc3RhdGUgPSB7fTtcclxuICAgIFxyXG4gICAgc3RhdGUuc3VtbWFyeSA9IHt9O1xyXG4gICAgXHJcbiAgICBpZihtb2RlID09PSBcIk5JTVNfU2VydmVyXCIgJiYgUEVSTUlTU0lPTl9JTkZPUk1FUl9FTkFCTEVEKXtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLnJlZnJlc2ggPSBmdW5jdGlvbihjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgIH07XHJcbi8vICAgICAgICBleHBvcnRzLnJlZnJlc2ggPSBmdW5jdGlvbihjYWxsYmFjaykge1xyXG4vLyAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gJC5hamF4KHtcclxuLy8gICAgICAgICAgICAgICAgdXJsIDogXCIvZ2V0UGVybWlzc2lvbnNTdW1tYXJ5XCIsXHJcbi8vICAgICAgICAgICAgICAgIGRhdGFUeXBlIDogXCJ0ZXh0XCIsXHJcbi8vICAgICAgICAgICAgICAgIG1ldGhvZCA6IFwiR0VUXCIsXHJcbi8vICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlIDogXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLThcIixcclxuLy8gICAgICAgICAgICAgICAgdGltZW91dDogQ29uc3RhbnRzLmh0dHBUaW1lb3V0XHJcbi8vICAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICAgICAgXHJcbi8vICAgICAgICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuLy8gICAgICAgICAgICAgICAgc3RhdGUuc3VtbWFyeSA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbi8vICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKXtcclxuLy8gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbi8vICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnN1YnNjcmliZSgpO1xyXG4vLyAgICAgICAgICAgICAgICB9XHJcbi8vICAgIC8vICAgICAgICBhbGVydChkYXRhKTtcclxuLy8gICAgLy8gICAgICAgIGFsZXJ0KHN0YXRlLnN1bW1hcnkpO1xyXG4vLyAgICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgICAgIFxyXG4vLyAgICAgICAgICAgIHJlcXVlc3QuZmFpbChmdW5jdGlvbihlcnJvckluZm8sIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbi8vICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKXtcclxuLy8gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9ySW5mby5yZXNwb25zZVRleHQgfHwgJ2Vycm9yJyk7XHJcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbi8vICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGV4cG9ydHMuc3Vic2NyaWJlLCA1MDApO1xyXG4vLyAgICAgICAgICAgICAgICB9XHJcbi8vICAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICB9O1xyXG4vLyAgICAgICAgXHJcbi8vICAgICAgICBleHBvcnRzLnN1YnNjcmliZSA9IGZ1bmN0aW9uKCkge1xyXG4vLyAgICAgICAgICAgIFxyXG4vLyAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gJC5hamF4KHtcclxuLy8gICAgICAgICAgICAgICAgdXJsIDogXCIvc3Vic2NyaWJlT25QZXJtaXNzaW9uc1VwZGF0ZVwiLFxyXG4vLyAgICAgICAgICAgICAgICBkYXRhVHlwZSA6IFwidGV4dFwiLFxyXG4vLyAgICAgICAgICAgICAgICBtZXRob2QgOiBcIkdFVFwiLFxyXG4vLyAgICAgICAgICAgICAgICBjb250ZW50VHlwZSA6IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04XCIsXHJcbi8vICAgICAgICAgICAgICAgIHRpbWVvdXQ6IENvbnN0YW50cy5odHRwVGltZW91dFxyXG4vLyAgICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgICAgIFxyXG4vLyAgICAgICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbi8vICAgICAgICAgICAgICAgIHN0YXRlLnN1bW1hcnkgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4vLyAgICAvLyAgICAgICAgYWxlcnQoZGF0YSk7XHJcbi8vICAgIC8vICAgICAgICBhbGVydChzdGF0ZS5zdW1tYXJ5KTtcclxuLy8gICAgICAgICAgICAgICAgZXhwb3J0cy5zdWJzY3JpYmUoKTtcclxuLy8gICAgICAgICAgICB9KTtcclxuLy8gICAgICAgICAgICBcclxuLy8gICAgICAgICAgICByZXF1ZXN0LmZhaWwoZnVuY3Rpb24oZXJyb3JJbmZvLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xyXG4vLyAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGV4cG9ydHMuc3Vic2NyaWJlLCA1MDApO1xyXG4vLyAgICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgfTtcclxuLy8gICAgICAgIFxyXG4vLyAgICAgICAgZXhwb3J0cy5yZWZyZXNoKCk7XHJcbiAgICBcclxuICAgICAgICBleHBvcnRzLmlzQWRtaW4gPSBmdW5jdGlvbihjYWxsYmFjayl7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHN0YXRlLnN1bW1hcnkuaXNBZG1pbik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLmlzRWRpdG9yID0gZnVuY3Rpb24oY2FsbGJhY2spe1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBzdGF0ZS5zdW1tYXJ5LmlzRWRpdG9yKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cG9ydHMuaXNFbnRpdHlFZGl0YWJsZSA9IGZ1bmN0aW9uKHR5cGUsIGVudGl0eU5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGlzT2JqZWN0RWRpdGFibGVTeW5jKHR5cGUsIGVudGl0eU5hbWUpKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBpc09iamVjdEVkaXRhYmxlU3luYyA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUpe1xyXG4gICAgICAgICAgICBpZihzdGF0ZS5zdW1tYXJ5LmlzRWRpdG9yKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHN0YXRlLnN1bW1hcnkuZXhpc3RFZGl0b3Ipe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5zdW1tYXJ5LnVzZXJbdHlwZV0uaW5kZXhPZihuYW1lKSAhPT0gLTE7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuLy8gICAgICAgIGV4cG9ydHMuZ2V0RW50aXR5TmFtZXNBcnJheSA9IFIuY3VycnkoZnVuY3Rpb24odHlwZSwgZWRpdGFibGVPbmx5LCBjYWxsYmFjayl7XHJcbi8vICAgICAgICAgICAgdmFyIHVzZXJFbnRpdGllcyA9IHN0YXRlLnN1bW1hcnkudXNlclt0eXBlXTtcclxuLy8gICAgICAgICAgICB2YXIgYWxsRW50aXRpZXMgPSBzdGF0ZS5zdW1tYXJ5LmFsbFt0eXBlXTtcclxuLy8gICAgICAgICAgICB2YXIgb3duZXJNYXAgPSBzdGF0ZS5zdW1tYXJ5Lm93bmVyTWFwc1t0eXBlXTtcclxuLy8gICAgICAgICAgICB2YXIgbmFtZXMgPSBhbGxFbnRpdGllcy5maWx0ZXIoZnVuY3Rpb24obmFtZSl7XHJcbi8vICAgICAgICAgICAgICAgIGlmKGVkaXRhYmxlT25seSl7XHJcbi8vICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNPYmplY3RFZGl0YWJsZVN5bmModHlwZSwgbmFtZSk7XHJcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbi8vICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuLy8gICAgICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbihuYW1lKXtcclxuLy8gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuLy8gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lIDogb3duZXJNYXBbbmFtZV0gKyBcIi4gXCIgKyBuYW1lLFxyXG4vLyAgICAgICAgICAgICAgICAgICAgdmFsdWUgOiBuYW1lLFxyXG4vLyAgICAgICAgICAgICAgICAgICAgZWRpdGFibGUgOiBpc09iamVjdEVkaXRhYmxlU3luYyh0eXBlLCBuYW1lKSxcclxuLy8gICAgICAgICAgICAgICAgICAgIGlzT3duZXIgOiB1c2VyRW50aXRpZXMuaW5kZXhPZihuYW1lKSAhPT0gLTFcclxuLy8gICAgICAgICAgICAgICAgfTtcclxuLy8gICAgICAgICAgICB9KTtcclxuLy8gICAgICAgICAgICBcclxuLy8gICAgICAgICAgICBuYW1lcy5zb3J0KFV0aWxzLmNoYXJPcmRBT2JqZWN0KTtcclxuLy8gICAgICAgICAgICBcclxuLy8gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBuYW1lcyk7XHJcbi8vICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLmdldEVudGl0eU5hbWVzQXJyYXkgPSBSLmN1cnJ5KGZ1bmN0aW9uKHR5cGUsIGVkaXRhYmxlT25seSwgY2FsbGJhY2spe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzTmFtZXMoZXJyLCBuYW1lcyl7XHJcbiAgICAgICAgICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgICAgICAgICAgdmFyIG5ld05hbWVzID0gW107XHJcbiAgICAgICAgICAgICAgICBuYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld05hbWVzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTpuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTpuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBuZXdOYW1lcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgREJNUy5nZXRFbnRpdHlOYW1lc0FycmF5KHR5cGUsIHByb2Nlc3NOYW1lcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwb3J0cy5hcmVBZGFwdGF0aW9uc0VkaXRhYmxlID0gZnVuY3Rpb24oYWRhcHRhdGlvbnMsIGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHt9O1xyXG4gICAgICAgICAgICB2YXIgaXNBZGFwdGF0aW9uUmlnaHRzQnlTdG9yeSA9IHN0YXRlLnN1bW1hcnkuaXNBZGFwdGF0aW9uUmlnaHRzQnlTdG9yeTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGFkYXB0YXRpb25zLmZvckVhY2goZnVuY3Rpb24oZWxlbSl7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZWxlbS5zdG9yeU5hbWUgKyBcIi1cIiArIGVsZW0uY2hhcmFjdGVyTmFtZTtcclxuICAgICAgICAgICAgICAgIGlmKGlzQWRhcHRhdGlvblJpZ2h0c0J5U3Rvcnkpe1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcFtrZXldID0gaXNPYmplY3RFZGl0YWJsZVN5bmMoJ3N0b3J5JywgZWxlbS5zdG9yeU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXBba2V5XSA9IGlzT2JqZWN0RWRpdGFibGVTeW5jKCdjaGFyYWN0ZXInLCBlbGVtLmNoYXJhY3Rlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIG1hcCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gXCJTdGFuZGFsb25lXCIpe1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cG9ydHMucmVmcmVzaCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLmlzQWRtaW4gPSBmdW5jdGlvbihjYWxsYmFjayl7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHRydWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwb3J0cy5pc0VkaXRvciA9IGZ1bmN0aW9uKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLmdldEVudGl0eU5hbWVzQXJyYXkgPSBSLmN1cnJ5KGZ1bmN0aW9uKHR5cGUsIGVkaXRhYmxlT25seSwgY2FsbGJhY2spe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzTmFtZXMoZXJyLCBuYW1lcyl7XHJcbiAgICAgICAgICAgICAgICBpZihlcnIpIHtVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47fVxyXG4gICAgICAgICAgICAgICAgdmFyIG5ld05hbWVzID0gW107XHJcbiAgICAgICAgICAgICAgICBuYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld05hbWVzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTpuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTpuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBuZXdOYW1lcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgREJNUy5nZXRFbnRpdHlOYW1lc0FycmF5KHR5cGUsIHByb2Nlc3NOYW1lcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwb3J0cy5pc0VudGl0eUVkaXRhYmxlID0gZnVuY3Rpb24odHlwZSwgZW50aXR5TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBleHBvcnRzLmFyZUFkYXB0YXRpb25zRWRpdGFibGUgPSBmdW5jdGlvbihhZGFwdGF0aW9ucywgY2FsbGJhY2spe1xyXG4gICAgICAgICAgICB2YXIgbWFwID0ge307XHJcbiAgICAgICAgICAgIGFkYXB0YXRpb25zLmZvckVhY2goZnVuY3Rpb24oZWxlbSl7XHJcbiAgICAgICAgICAgICAgICBtYXBbZWxlbS5zdG9yeU5hbWUgKyBcIi1cIiArIGVsZW0uY2hhcmFjdGVyTmFtZV0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIG1hcCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKHRoaXNbJ1Blcm1pc3Npb25JbmZvcm1lciddPXt9LCBNT0RFKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
